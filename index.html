<!doctype html>
<html class="theme-next use-motion theme-next-mist">
<head>
  

<meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>






  <link rel="stylesheet" type="text/css" href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5"/>




<link rel="stylesheet" type="text/css" href="/css/main.css?v=0.4.3"/>


    <meta name="description" content="零碎的笔记" />



  <meta name="keywords" content="Hexo,next" />





  <link rel="shorticon icon" type="image/x-icon" href="/favicon.ico?v=0.4.3" />



<script type="text/javascript" id="hexo.configuration">
  var CONFIG = {
    scheme: 'Mist',
    analytics: {
      google: 'UA-49960399-2'
    },
    sidebar: 'hide'
  };
</script>




  <title> Xiaoke's Blog </title>
</head>

<body>
  <!--[if lte IE 8]>
  <div style=' clear: both; height: 59px; padding:0 0 0 15px; position: relative;margin:0 auto;'>
    <a href="http://windows.microsoft.com/en-US/internet-explorer/products/ie/home?ocid=ie6_countdown_bannercode">
      <img src="http://7u2nvr.com1.z0.glb.clouddn.com/picouterie.jpg" border="0" height="42" width="820"
           alt="You are using an outdated browser. For a faster, safer browsing experience, upgrade for free today or use other browser ,like chrome firefox safari."
           style='margin-left:auto;margin-right:auto;display: block;'/>
    </a>
  </div>
<![endif]-->

  <div class="container one-column 
   page-home 
">
    <div class="headband"></div>

    <div id="header" class="header">
      <div class="header-inner">
        <h1 class="site-meta">
  <span class="logo-line-before"><i></i></span>
  <a href="/" class="brand">
      <span class="logo">
        <i class="icon-logo"></i>
      </span>
      <span class="site-title">Xiaoke's Blog</span>
  </a>
  <span class="logo-line-after"><i></i></span>
</h1>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<div class="site-nav">
  

  
    <ul id="menu" class="menu ">
      
        
        <li class="menu-item menu-item-home">
          <a href="/">
            <i class="menu-item-icon icon-home"></i> <br />
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about">
            <i class="menu-item-icon icon-about"></i> <br />
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives">
            <i class="menu-item-icon icon-archives"></i> <br />
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags">
            <i class="menu-item-icon icon-tags"></i> <br />
            标签
          </a>
        </li>
      
    </ul>
  

  
</div>


      </div>
    </div>

    <div id="main" class="main">
      <div class="main-inner">
        <div id="content" class="content">
          
  <div id="posts" class="posts-expand">
    
      

  <div class="post post-type-normal ">
    <div class="post-header">

      
      
        <h1 class="post-title">
          
          
            
              <a class="post-title-link" href="/2015/07/15/python-image-exif-rename-md/">
                根据EXIF拍摄时间批量重命名照片
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          发表于 2015-07-15
        </span>

        
          <span class="post-category">
            &nbsp; | &nbsp; 分类于
            
              <a href="/categories/Python/">Python</a>

              
              

            
          </span>
        

        
          
            <span class="post-comments-count">
            &nbsp; | &nbsp;
            <a href="/2015/07/15/python-image-exif-rename-md/#comments" >
              <span class="post-comments-count ds-thread-count" data-thread-key="2015/07/15/python-image-exif-rename-md/"></span>
            </a>
          </span>
          
        
      </div>
    </div>

    <div class="post-body">

      
      

      
        
          <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># @Author: mcxiaoke</span></span><br><span class="line"><span class="comment"># @Date:   2015-07-10 08:24:23</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> codecs</span><br><span class="line"><span class="keyword">import</span> exifread</span><br><span class="line"><span class="keyword">from</span> os <span class="keyword">import</span> path</span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"></span><br><span class="line">TAGS = [</span><br><span class="line">    <span class="string">'GPS GPSLatitude'</span>,</span><br><span class="line">    <span class="string">'GPS GPSLongitude'</span>,</span><br><span class="line">    <span class="string">'GPS GPSDate'</span>,</span><br><span class="line">    <span class="string">'GPS GPSImgDirection'</span>,</span><br><span class="line">    <span class="string">'Image DateTime'</span>,</span><br><span class="line">    <span class="string">'Image Orientation'</span>,</span><br><span class="line">    <span class="string">'Image Software'</span>,</span><br><span class="line">    <span class="string">'Image Model'</span>,</span><br><span class="line">    <span class="string">'Image Make'</span>,</span><br><span class="line">    <span class="string">'Image XResolution'</span>,</span><br><span class="line">    <span class="string">'Image YResolution'</span>,</span><br><span class="line">    <span class="string">'EXIF ExifVersion'</span>,</span><br><span class="line">    <span class="string">'EXIF ExifImageLength'</span>,</span><br><span class="line">    <span class="string">'EXIF ExifImageWidth'</span>,</span><br><span class="line">    <span class="string">'EXIF LensMake'</span>,</span><br><span class="line">    <span class="string">'EXIF LensModel'</span>,</span><br><span class="line">    <span class="string">'EXIF FocalLength'</span>,</span><br><span class="line">    <span class="string">'EXIF WhiteBalance'</span>,</span><br><span class="line">    <span class="string">'EXIF ISOSpeedRatings'</span>,</span><br><span class="line">    <span class="string">'EXIF ExposureMode'</span>,</span><br><span class="line">    <span class="string">'EXIF ExposureTime'</span>,</span><br><span class="line">    <span class="string">'EXIF ExposureProgram'</span>,</span><br><span class="line">    <span class="string">'EXIF DateTimeOriginal'</span>,</span><br><span class="line">    <span class="string">'EXIF DateTimeDigitized'</span>,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">NAME_TAGS = [</span><br><span class="line">    <span class="string">'GPS GPSDate'</span>,</span><br><span class="line">    <span class="string">'Image DateTime'</span>,</span><br><span class="line">    <span class="string">'Image Model'</span>,</span><br><span class="line">    <span class="string">'Image XResolution'</span>,</span><br><span class="line">    <span class="string">'Image YResolution'</span>,</span><br><span class="line">    <span class="string">'EXIF ExifImageLength'</span>,</span><br><span class="line">    <span class="string">'EXIF ExifImageWidth'</span>,</span><br><span class="line">    <span class="string">'EXIF ISOSpeedRatings'</span>,</span><br><span class="line">    <span class="string">'EXIF DateTimeOriginal'</span>,</span><br><span class="line">    <span class="string">'EXIF DateTimeDigitized'</span>,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">EXIF_DATE_TIME = <span class="string">'%Y:%m:%d %H:%M:%S'</span></span><br><span class="line">NAME_DATE_TIME = <span class="string">'IMG_%Y%m%d_%H%M%S'</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ImageInfo</span><span class="params">(object)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, path, width, height, time=None, iso=<span class="number">0</span>, model=None)</span>:</span></span><br><span class="line">        self.path = path</span><br><span class="line">        self.width = width</span><br><span class="line">        self.height = height</span><br><span class="line">        self.time = time</span><br><span class="line">        self.iso = iso</span><br><span class="line">        self.model = model</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line">        time_str = datetime.strftime(</span><br><span class="line">            self.time, EXIF_DATE_TIME) <span class="keyword">if</span> self.time <span class="keyword">else</span> <span class="string">''</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">'Image&#123;path=%s,width=%s,height=%s,time=%s,iso=%s,model=%s&#125;'</span> % (</span><br><span class="line">            self.path, self.width, self.height,</span><br><span class="line">            time_str, self.iso, self.model)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> len(sys.argv) &lt; <span class="number">2</span>:</span><br><span class="line">    <span class="keyword">print</span> <span class="string">'Usage: python %s some_directory'</span> % sys.argv[<span class="number">0</span>]</span><br><span class="line">    sys.exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">top = unicode(path.normcase(sys.argv[<span class="number">1</span>]))</span><br><span class="line">log = codecs.open(path.join(top, <span class="string">'log.txt'</span>), <span class="string">'w'</span>, <span class="string">'utf-8'</span>)</span><br><span class="line"><span class="keyword">for</span> root, dirs, files <span class="keyword">in</span> os.walk(top):</span><br><span class="line">    <span class="keyword">for</span> name <span class="keyword">in</span> files:</span><br><span class="line">        _, ext = path.splitext(name)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> ext <span class="keyword">or</span> ext.lower() <span class="keyword">not</span> <span class="keyword">in</span> [<span class="string">'.jpg'</span>, <span class="string">'.png'</span>]:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        rel_path = path.join(root, name)</span><br><span class="line">        src_path = path.abspath(rel_path)</span><br><span class="line">        <span class="keyword">print</span> <span class="string">"process file:"</span>, src_path</span><br><span class="line">        f = open(path.join(root, name), <span class="string">'rb'</span>)</span><br><span class="line">        tags = exifread.process_file(f)</span><br><span class="line">        f.close()</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> tags:</span><br><span class="line">            log.write(<span class="string">'No exif tags found for: %s\n'</span> % rel_path)</span><br><span class="line">        <span class="string">'''</span><br><span class="line">        img_path = src_path</span><br><span class="line">        width_str = str(tags.get('EXIF ExifImageWidth'))</span><br><span class="line">        height_str = str(tags.get('EXIF ExifImageLength'))</span><br><span class="line">        img_w = int(width_str) if width_str and width_str.isdigit() else 0</span><br><span class="line">        img_h = int(height_str) if height_str and height_str.isdigit() else 0</span><br><span class="line">        time_str = str(tags.get('Image DateTime'))</span><br><span class="line">        img_time = datetime.strptime(</span><br><span class="line">            time_str, EXIF_DATE_TIME) if time_str else None</span><br><span class="line">        iso_str = str(tags.get('EXIF ISOSpeedRatings'))</span><br><span class="line">        print 'iso_str=%s' % iso_str</span><br><span class="line">        img_iso = int(iso_str) if iso_str and iso_str.isdigit() else 0</span><br><span class="line">        img_model = str(tags.get('Image Model'))</span><br><span class="line">        img = ImageInfo(img_path, img_w, img_h, time=img_time,</span><br><span class="line">                        iso=img_iso, model=img_model)</span><br><span class="line">        '''</span></span><br><span class="line">        time_str = str(tags.get(<span class="string">'Image DateTime'</span>)) <span class="keyword">if</span> tags <span class="keyword">else</span> <span class="keyword">None</span></span><br><span class="line">        img_time = datetime.strptime(</span><br><span class="line">            time_str, EXIF_DATE_TIME) <span class="keyword">if</span> time_str <span class="keyword">else</span> <span class="keyword">None</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> img_time:</span><br><span class="line">            os.stat(src_path)</span><br><span class="line">            img_time = datetime.fromtimestamp(os.stat(src_path).st_mtime)</span><br><span class="line">            <span class="keyword">print</span> <span class="string">'no exif, using last modified time for %s'</span> % name</span><br><span class="line">            log.write(<span class="string">'using stat modify time for %s\n'</span> % name)</span><br><span class="line">        dst_path = path.join(</span><br><span class="line">            root, datetime.strftime(img_time, NAME_DATE_TIME)+ext.lower())</span><br><span class="line">        <span class="keyword">if</span> path.exists(dst_path):</span><br><span class="line">            <span class="keyword">print</span> <span class="string">'dst file exists, no need to rename, skip %s'</span> % name</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        os.rename(src_path, dst_path)</span><br><span class="line">        <span class="keyword">print</span> <span class="string">'renamed to'</span>, dst_path</span><br><span class="line">        log.flush()</span><br><span class="line"></span><br><span class="line">log.close()</span><br></pre></td></tr></table></figure>

        
      
    </div>

    <div class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </div>
  </div>


    
      

  <div class="post post-type-normal ">
    <div class="post-header">

      
      
        <h1 class="post-title">
          
          
            
              <a class="post-title-link" href="/2014/06/30/android-dev-notes-03/">
                Android开发杂记（三）
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          发表于 2014-06-30
        </span>

        
          <span class="post-category">
            &nbsp; | &nbsp; 分类于
            
              <a href="/categories/Android/">Android</a>

              
              

            
          </span>
        

        
          
            <span class="post-comments-count">
            &nbsp; | &nbsp;
            <a href="/2014/06/30/android-dev-notes-03/#comments" >
              <span class="post-comments-count ds-thread-count" data-thread-key="2014/06/30/android-dev-notes-03/"></span>
            </a>
          </span>
          
        
      </div>
    </div>

    <div class="post-body">

      
      

      
        
          <p>这是另一部分的Android开发笔记整理</p>
<h3 id="如何完全不显示一个Activity的UI">如何完全不显示一个Activity的UI</h3><p>可以使用 <code>android:theme=&quot;@android:style/Theme.NoDisplay&quot;</code> 但是有一个注意事项，见<br><a href="http://stackoverflow.com/questions/4551868/how-to-completely-get-rid-of-an-activitys-gui-avoid-a-black-screen" target="_blank" rel="external">how to completely get rid of an activity’s GUI</a></p>
<h3 id="如何移除ActionBar底部的阴影">如何移除ActionBar底部的阴影</h3><p>自定义ActionBar的Style，使用 <code>&lt;item name=&quot;android:windowContentOverlay&quot;&gt;@null&lt;/item&gt;</code> 如果是使用ActionBarSherlock或ActionBarCompat，还需要添加 <code>&lt;item name=&quot;windowContentOverlay&quot;&gt;@null&lt;/item&gt;</code>，参考：<a href="http://stackoverflow.com/questions/11448679/how-can-i-have-a-drop-shadow-on-my-actionbar-actionbarsherlock" target="_blank" rel="external">How can I have a drop shadow on my ActionBar</a></p>
<h3 id="使用Gradle时私密存储签名密钥">使用Gradle时私密存储签名密钥</h3><p>参考这个Gist：<a href="https://gist.github.com/mcxiaoke/8450376" target="_blank" rel="external">build.gradle</a></p>
<h3 id="透明的Activity退出后，没有真正finish的问题">透明的Activity退出后，没有真正finish的问题</h3><p>具体见 <a href="http://blog.sina.com.cn/s/blog_601cbd070100npf8.html" target="_blank" rel="external">这里的分析</a><br>android:windowShowWallpaper = true的作用，这并不是在后面显示桌面，是配置Activity的背景为桌面背景</p>
<h3 id="Background和Seletor必须使用真实的Drawable">Background和Seletor必须使用真实的Drawable</h3><p>否则，有些三星和摩托的机子上会没有背景，显示纯黑色，定义在colors.xml里的伪drawble不行</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">color</span> <span class="attribute">name</span>=<span class="value">"mail_published_time_color"</span>&gt;</span>#bcbcbc<span class="tag">&lt;/<span class="title">color</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">drawable</span> <span class="attribute">name</span>=<span class="value">"ab_bg_black"</span>&gt;</span>#aa191919<span class="tag">&lt;/<span class="title">drawable</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>必须是真实的图片drawable或者定义好的shape</p>
<h3 id="合并多个git仓库，保留commit记录的方法">合并多个git仓库，保留commit记录的方法</h3><p>详情见<a href="http://stackoverflow.com/questions/1683531/how-to-import-existing-git-repository-into-another" target="_blank" rel="external">How to import existing GIT repository into another</a>和<a href="https://github.com/deercoder/Linux/blob/master/Git/git_merge_local_repos.md" target="_blank" rel="external">合并已存在的git仓库</a></p>
<h3 id="WebView浏览位置的保存和恢复">WebView浏览位置的保存和恢复</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 保存位置</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">float</span> <span class="title">savePosition</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    LogUtils.v(TAG, <span class="string">"savePosition()"</span>);</span><br><span class="line">    <span class="keyword">float</span> top = getTop();</span><br><span class="line">    <span class="keyword">float</span> contentHeight = getContentHeight();</span><br><span class="line">    <span class="keyword">float</span> scrollY = getScrollY();</span><br><span class="line">    mSavedPosition = (scrollY - top) / contentHeight;</span><br><span class="line">    <span class="keyword">return</span> mSavedPosition;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 恢复位置</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">float</span> <span class="title">restorePosition</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    LogUtils.v(TAG, <span class="string">"restorePosition()"</span>);</span><br><span class="line">    <span class="keyword">if</span> (mSavedPosition &gt; <span class="number">0f</span>) &#123;</span><br><span class="line">        <span class="keyword">float</span> top = getTop();</span><br><span class="line">        <span class="keyword">float</span> contentHeight = getContentHeight();</span><br><span class="line">        <span class="keyword">float</span> height = contentHeight - top;</span><br><span class="line">        <span class="keyword">float</span> positionInViewPort = height * mSavedPosition;</span><br><span class="line">        <span class="keyword">int</span> positionY = Math.round(top + positionInViewPort);</span><br><span class="line">        scrollTo(<span class="number">0</span>, positionY);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> mSavedPosition;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="使用拨号键盘的SecretCode功能">使用拨号键盘的SecretCode功能</h3><p>Android的拨号键盘有一些特殊的定义键，可以启动自定义的Intent，用法：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">receiver</span> <span class="attribute">android:name</span>=<span class="value">".receiver.DiagnoserReceiver"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">intent-filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">action</span> <span class="attribute">android:name</span>=<span class="value">"android.provider.Telephony.SECRET_CODE"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">data</span> <span class="attribute">android:scheme</span>=<span class="value">"android_secret_code"</span> <span class="attribute">android:host</span>=<span class="value">"111222"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="title">intent-filter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">receiver</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>参考资料：<br><a href="http://udinic.wordpress.com/2013/05/17/create-a-secret-doorway-to-your-app/" target="_blank" rel="external">Create a secret doorway to your app</a><br><a href="https://code.google.com/p/android-roms/wiki/Secret_Star_Codes" target="_blank" rel="external">Secret_Star_Codes</a></p>
<h3 id="阻止点击DrawLayout时事件传递到下一层">阻止点击DrawLayout时事件传递到下一层</h3><p>方法是给Drawlayout添加一个OnClickListener<br>参考资料：<br><a href="http://stackoverflow.com/questions/18811973/android-how-do-i-keep-drawerlayout-from-passing-touch-events-to-the-underlying" target="_blank" rel="external">How do I keep DrawerLayout from passing touch events to the underlying view</a></p>
<h3 id="没有root的情况下如何adb_pull_/data/data/package/下的数据">没有root的情况下如何adb pull /data/data/package/下的数据</h3><p>下面是一个查看应用数据库的例子脚本：</p>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">PACKAGE_NAME=com.your.<span class="keyword">package</span></span><br><span class="line">DB_NAME=data.db</span><br><span class="line">rm -rf <span class="variable">$&#123;DB_NAME&#125;</span></span><br><span class="line">adb shell <span class="string">"run-as <span class="subst">$&#123;PACKAGE_NAME&#125;</span> chmod 666 /data/data/<span class="subst">$&#123;PACKAGE_NAME&#125;</span>/databases/<span class="subst">$&#123;DB_NAME&#125;</span>"</span></span><br><span class="line">adb pull /data/data/<span class="variable">$&#123;PACKAGE_NAME&#125;</span>/databases/<span class="variable">$&#123;DB_NAME&#125;</span> /tmp/</span><br><span class="line">adb shell <span class="string">"run-as <span class="subst">$&#123;PACKAGE_NAME&#125;</span> chmod 600 /data/data/<span class="subst">$&#123;PACKAGE_NAME&#125;</span>/databases/<span class="subst">$&#123;DB_NAME&#125;</span>"</span></span><br><span class="line">sqlite3 /tmp/$&#123;DB_NAME</span><br></pre></td></tr></table></figure>
<p>分析见：<br> <a href="http://stackoverflow.com/questions/18471780/android-adb-retrieve-database-using-run-as" target="_blank" rel="external">android adb, retrieve database using run-as</a><br><a href="http://blog.shvetsov.com/2013/02/access-android-app-data-without-root.html" target="_blank" rel="external">Access Android app data without root</a></p>
<h3 id="快速获取电池电量的方法">快速获取电池电量的方法</h3><figure class="highlight processing"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> Intent getBatteryStatus(Context context) &#123;</span><br><span class="line">    Context appContext = context.getApplicationContext();</span><br><span class="line">    <span class="keyword">return</span> appContext.registerReceiver(<span class="keyword">null</span>,</span><br><span class="line">            <span class="keyword">new</span> IntentFilter(Intent.ACTION_BATTERY_CHANGED));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">String</span> getBatteryInfo(Context context, Intent batteryIntent) &#123;</span><br><span class="line">    <span class="built_in">int</span> status = batteryIntent.getIntExtra(BatteryManager.EXTRA_STATUS, -<span class="number">1</span>);</span><br><span class="line">    <span class="built_in">boolean</span> isCharging = status == BatteryManager.BATTERY_STATUS_CHARGING ||</span><br><span class="line">            status == BatteryManager.BATTERY_STATUS_FULL;</span><br><span class="line">    <span class="built_in">int</span> chargePlug = batteryIntent.getIntExtra(BatteryManager.EXTRA_PLUGGED, -<span class="number">1</span>);</span><br><span class="line">    <span class="built_in">boolean</span> usbCharge = chargePlug == BatteryManager.BATTERY_PLUGGED_USB;</span><br><span class="line">    <span class="built_in">boolean</span> acCharge = chargePlug == BatteryManager.BATTERY_PLUGGED_AC;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">int</span> level = batteryIntent.getIntExtra(BatteryManager.EXTRA_LEVEL, -<span class="number">1</span>);</span><br><span class="line">    <span class="built_in">int</span> <span class="built_in">scale</span> = batteryIntent.getIntExtra(BatteryManager.EXTRA_SCALE, -<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">float</span> batteryPct = level / (<span class="built_in">float</span>) <span class="built_in">scale</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"Battery Info: isCharging="</span> + isCharging</span><br><span class="line">            + <span class="string">" usbCharge="</span> + usbCharge + <span class="string">" acCharge="</span> + acCharge</span><br><span class="line">            + <span class="string">" batteryPct="</span> + batteryPct;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>分析见：<a href="http://stackoverflow.com/questions/3661464/get-battery-level-before-broadcast-receiver-responds-for-intent-action-battery-c" target="_blank" rel="external">Get battery level before broadcast receiver responds for Intent.ACTION_BATTERY_CHANGED</a></p>
<h3 id="ActionBar的Title是否可以点击的问题">ActionBar的Title是否可以点击的问题</h3><p>4.2之前和之后这个有变化，4.2之前只有Icon可以点击，如果没有Icon，Title就无法点击，4.2之后是Title和Icon一起作为点击区域<br>分析见：<a href="http://stackoverflow.com/questions/16209963/action-bar-icon-as-up-enabled-not-the-title/16216966#16216966" target="_blank" rel="external">Action Bar icon as up enabled not the title</a> </p>
<h3 id="Webview滚动时背景闪烁的问题">Webview滚动时背景闪烁的问题</h3><p>因是渲染帧数不够<br>如果使用软件渲染，看下文：<a href="http://stackoverflow.com/questions/17315815/strange-webview-black-blinking-when-scrolling" target="_blank" rel="external">Strange webview black blinking when scrolling</a>，或者启用硬件加速</p>
<h3 id="Java中使用try_catch的性能问题">Java中使用try catch的性能问题</h3><p>使用try catch并没有额外的性能损耗，只有异常真正发生时才会有性能损耗，详细分析见：<a href="http://stackoverflow.com/questions/2633834/should-java-try-blocks-be-scoped-as-tightly-as-possible" target="_blank" rel="external">Should java try blocks be scoped as tightly as possible</a></p>

        
      
    </div>

    <div class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </div>
  </div>


    
      

  <div class="post post-type-normal ">
    <div class="post-header">

      
      
        <h1 class="post-title">
          
          
            
              <a class="post-title-link" href="/2014/06/30/vps-nginx-php5-fpm-config/">
                在VPS上配置Nginx和PHP
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          发表于 2014-06-30
        </span>

        
          <span class="post-category">
            &nbsp; | &nbsp; 分类于
            
              <a href="/categories/Web/">Web</a>

              
              

            
          </span>
        

        
          
            <span class="post-comments-count">
            &nbsp; | &nbsp;
            <a href="/2014/06/30/vps-nginx-php5-fpm-config/#comments" >
              <span class="post-comments-count ds-thread-count" data-thread-key="2014/06/30/vps-nginx-php5-fpm-config/"></span>
            </a>
          </span>
          
        
      </div>
    </div>

    <div class="post-body">

      
      

      
        
          <p>之前买了一个廉价VPS，系统是Ubuntu 12.04，一直没有用上，最近装上Nginx和PHP，下面就是配置记录。</p>
<p>首先当然是安装各种必备的工具：</p>
<figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="label">sudo</span> apt-<span class="preprocessor">get</span> install php5-<span class="preprocessor">common</span> php5-cli php5-fpm</span><br><span class="line"><span class="label">sudo</span> apt-<span class="preprocessor">get</span> install nginx</span><br></pre></td></tr></table></figure>
<p>下面是nginx的配置文件，位置是 <code>/etc/nginx/sites-available/mcxiaoke.com</code></p>
<p>这里假设我的域名是 <code>mcxiaoke.com</code></p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 配置HTTP站点</span></span><br><span class="line"><span class="title">server</span> &#123;</span><br><span class="line"><span class="title">listen</span> <span class="number">80</span>;</span><br><span class="line"><span class="comment"># 站点根目录</span></span><br><span class="line"><span class="title">root</span> /var/www/;</span><br><span class="line"></span><br><span class="line"><span class="title">index</span> index.php index.html index.htm index.php;</span><br><span class="line"></span><br><span class="line"><span class="title">server_name</span> mcxiaoke.com;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重定向所有HTTP到HTTPS</span></span><br><span class="line"><span class="title">rewrite</span><span class="regexp"> ^(.*)$</span> <span class="url">https://<span class="variable">$host</span><span class="variable">$1</span></span> <span class="built_in">permanent</span>;</span><br><span class="line"></span><br><span class="line"><span class="title">location</span> / &#123;</span><br><span class="line"><span class="title">try_files</span> <span class="variable">$uri</span> <span class="variable">$uri</span>/ /index.php<span class="variable">$is_args</span><span class="variable">$args</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title">error_page</span> <span class="number">404</span> /<span class="number">404</span>.html;</span><br><span class="line"></span><br><span class="line"><span class="comment"># redirect server error pages to the static page /50x.html</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="title">error_page</span> <span class="number">500</span> <span class="number">502</span> <span class="number">503</span> <span class="number">504</span> /50x.html;</span><br><span class="line"><span class="title">location</span> = /50x.html &#123;</span><br><span class="line"><span class="title">root</span> /usr/share/nginx/www;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置PHP</span></span><br><span class="line"><span class="title">location</span> <span class="regexp">~ \.php$</span> &#123;</span><br><span class="line"><span class="title">try_files</span> <span class="variable">$uri</span> =<span class="number">404</span>;</span><br><span class="line"><span class="title">fastcgi_pass</span> <span class="number">127.0.0.1:9000</span>;</span><br><span class="line"><span class="title">include</span> fastcgi_params;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置HTTPS站点</span></span><br><span class="line"><span class="title">server</span> &#123;</span><br><span class="line"><span class="title">listen</span> <span class="number">443</span>;</span><br><span class="line"><span class="title">server_name</span> mcxiaoke.com;</span><br><span class="line"><span class="comment">#站点根目录</span></span><br><span class="line"><span class="title">root</span> /var/www/;</span><br><span class="line"><span class="title">index</span> index.html index.htm index.php;</span><br><span class="line"></span><br><span class="line"><span class="title">ssl</span> <span class="built_in">on</span>;</span><br><span class="line"><span class="comment"># 这里是网站的SSL证书</span></span><br><span class="line"><span class="title">ssl_certificate</span> /etc/nginx/ssl/ssl.crt;</span><br><span class="line"><span class="title">ssl_certificate_key</span> /etc/nginx/ssl/ssl.key;</span><br><span class="line"></span><br><span class="line"><span class="title">ssl_session_timeout</span> <span class="number">10m</span>;</span><br><span class="line"></span><br><span class="line"><span class="title">ssl_ciphers</span> RC4:HIGH:!aNULL:!MD5;</span><br><span class="line"><span class="title">ssl_prefer_server_ciphers</span> <span class="built_in">on</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">#ssl_protocols SSLv3 TLSv1;</span></span><br><span class="line"><span class="comment">#ssl_ciphers ALL:!ADH:!EXPORT56:RC4+RSA:+HIGH:+MEDIUM:+LOW:+SSLv3:+EXP;</span></span><br><span class="line"><span class="comment">#ssl_prefer_server_ciphers on;</span></span><br><span class="line"></span><br><span class="line"><span class="title">location</span> / &#123;</span><br><span class="line"><span class="title">try_files</span> <span class="variable">$uri</span> <span class="variable">$uri</span>/ /index.php<span class="variable">$is_args</span><span class="variable">$args</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title">error_page</span> <span class="number">404</span> /<span class="number">404</span>.html;</span><br><span class="line"></span><br><span class="line"><span class="comment"># redirect server error pages to the static page /50x.html</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="title">error_page</span> <span class="number">500</span> <span class="number">502</span> <span class="number">503</span> <span class="number">504</span> /50x.html;</span><br><span class="line"><span class="title">location</span> = /50x.html &#123;</span><br><span class="line"><span class="title">root</span> /usr/share/nginx/www;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置PHP</span></span><br><span class="line"><span class="title">location</span> <span class="regexp">~ \.php$</span> &#123;</span><br><span class="line"><span class="title">try_files</span> <span class="variable">$uri</span> =<span class="number">404</span>;</span><br><span class="line"><span class="title">fastcgi_pass</span> <span class="number">127.0.0.1:9000</span>;</span><br><span class="line"><span class="title">include</span> fastcgi_params;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>配置好之后可以在某个目录下放一个info.php文件，内容如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="php"><span class="preprocessor">&lt;?php</span> phpinfo(); <span class="preprocessor">?&gt;</span></span>;</span><br></pre></td></tr></table></figure>
<p>然后重启服务：</p>
<figure class="highlight puppet"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="keyword">service</span> php5-fpm <span class="literal">restart</span></span><br><span class="line">sudo <span class="keyword">service</span> nginx <span class="literal">restart</span></span><br></pre></td></tr></table></figure>
<p>如果能正常访问，能看到服务器的PHP配置信息，就表明配置没有问题。</p>
<p>参考文章：<br><a href="https://www.digitalocean.com/community/tutorials/how-to-install-linux-nginx-mysql-php-lemp-stack-on-ubuntu-14-04" target="_blank" rel="external">How To Install LEMP stack on Ubuntu 14.04</a><br><a href="http://askubuntu.com/questions/134666/what-is-the-easiest-way-to-enable-php-on-nginx" target="_blank" rel="external">Mac OSX 10.9搭建nginx+mysql+php-fpm环境</a></p>

        
      
    </div>

    <div class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </div>
  </div>


    
      

  <div class="post post-type-normal ">
    <div class="post-header">

      
      
        <h1 class="post-title">
          
          
            
              <a class="post-title-link" href="/2014/02/25/android-dev-notes-02/">
                Android开发杂记（二）
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          发表于 2014-02-25
        </span>

        
          <span class="post-category">
            &nbsp; | &nbsp; 分类于
            
              <a href="/categories/Android/">Android</a>

              
              

            
          </span>
        

        
          
            <span class="post-comments-count">
            &nbsp; | &nbsp;
            <a href="/2014/02/25/android-dev-notes-02/#comments" >
              <span class="post-comments-count ds-thread-count" data-thread-key="2014/02/25/android-dev-notes-02/"></span>
            </a>
          </span>
          
        
      </div>
    </div>

    <div class="post-body">

      
      

      
        
          <p>2013年下半年的Android开发过程中记录的一些经验和教训，整理出来一部分</p>
<h3 id="Fragment的状态恢复问题_[20131218]">Fragment的状态恢复问题 [20131218]</h3><p>在FragmentActivity里，如果存在Fragment，系统恢复被销毁的Activity的同时会回复所有FragmentManager里的Fragment列表，然后添加到当前的Activity中，但问题是，Fragment虽然恢复了，状态却没有回复，这些都需要在onCreate或onRestoreInstanceState中手动处理。</p>
<p>FragmentActivity恢复状态的源码如下：</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// onCreate()中</span></span><br><span class="line"><span class="keyword">if</span> (savedInstanceState != <span class="literal">null</span>) &#123;</span><br><span class="line">    Parcelable p = savedInstanceState.getParcelable(FRAGMENTS_TAG);</span><br><span class="line">    <span class="comment">// FragmentManager的restoreAllState会将之前保存的Fragment重新添加到FragmentManager中，并恢复BackStack</span></span><br><span class="line">    mFragments.restoreAllState(p, nc != <span class="literal">null</span> ? nc.fragments : <span class="literal">null</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>保存状态的源码如下：</p>
<figure class="highlight pf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * Save <span class="literal">all</span> appropriate <span class="keyword">fragment</span> <span class="keyword">state</span>.</span><br><span class="line"> */</span><br><span class="line">@Override</span><br><span class="line">protected void <span class="keyword">on</span>SaveInstanceState(Bundle <span class="keyword">out</span>State) &#123;</span><br><span class="line">    super.<span class="keyword">on</span>SaveInstanceState(<span class="keyword">out</span>State);</span><br><span class="line">    Parcelable p = mFragments.saveAllState();</span><br><span class="line">    if (p != null) &#123;</span><br><span class="line">        <span class="keyword">out</span>State.putParcelable(FRAGMENTS_TAG, p);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Google建议onCreate中只在savedInstanceState为null的时候才创建和初始化Fragment，代码如下：</p>
<figure class="highlight openscad"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> <span class="params">(savedInstanceState == null)</span> &#123;</span><br><span class="line">            <span class="comment">// During initial setup, plug in the details fragment.</span></span><br><span class="line">            DetailsFragment details = new DetailsFragment<span class="params">()</span>;</span><br><span class="line">            details.setArguments<span class="params">(getIntent<span class="params">()</span>.getExtras<span class="params">()</span>)</span>;</span><br><span class="line">            getFragmentManager<span class="params">()</span>.beginTransaction<span class="params">()</span>.add<span class="params">(android.R.id.content, details)</span>.commit<span class="params">()</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>补充说明：onCreate()和onRestoreInstanceState()都可以用于应用的状态恢复，区别是onRestoreInstanceState()是在onStart()之后调用，可以根据具体情况选择时机。</p>
<h3 id="裁剪图片的Intent_[20131218]">裁剪图片的Intent [20131218]</h3><p>Android系统自带了Gallery和Camera，提供了剪裁和编辑图片功能，虽然没有提供一个文档化的接口，但通常还是可以安全的调用，两种方法都需要在onActivityResult()里处理裁剪结果。</p>
<p>方法一：对已有的图片进行裁剪，Intent如下：</p>
<figure class="highlight openscad"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">public static final String ACTION_CROP = <span class="string">"com.android.camera.action.CROP"</span>;</span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *   裁剪已有的图片</span><br><span class="line"> * @param activity 接受裁剪结果的Activity</span><br><span class="line"> * @param srcUri 原始图片Uri</span><br><span class="line"> * @param destUri 保存裁剪后图片的Uri</span><br><span class="line"> */</span></span><br><span class="line">public static void showCrop<span class="params">(Activity activity, Uri srcUri, Uri destUri)</span> &#123;</span><br><span class="line">    Intent intent = new Intent<span class="params">(ACTION_CROP)</span>;</span><br><span class="line">    <span class="comment">// 看源码得知，使用setData会清除type，直接setType会清除data</span></span><br><span class="line">    intent.setDataAndType<span class="params">(srcUri, <span class="string">"image/*"</span>)</span>;</span><br><span class="line">    <span class="comment">//set crop properties</span></span><br><span class="line">    intent.putExtra<span class="params">(<span class="string">"crop"</span>, <span class="string">"true"</span>)</span>;</span><br><span class="line">    <span class="comment">//indicate aspect of desired crop</span></span><br><span class="line">    intent.putExtra<span class="params">(<span class="string">"aspectX"</span>, <span class="number">1</span>)</span>;</span><br><span class="line">    intent.putExtra<span class="params">(<span class="string">"aspectY"</span>, <span class="number">1</span>)</span>;</span><br><span class="line">    intent.putExtra<span class="params">(<span class="string">"scale"</span>, <span class="literal">true</span>)</span>;</span><br><span class="line">    <span class="comment">//indicate output X and Y</span></span><br><span class="line">    intent.putExtra<span class="params">(<span class="string">"outputX"</span>, Constants.AVATAR_DIMEN_MEDIUM)</span>;</span><br><span class="line">    intent.putExtra<span class="params">(<span class="string">"outputY"</span>, Constants.AVATAR_DIMEN_MEDIUM)</span>;</span><br><span class="line">    <span class="comment">//retrieve data on return</span></span><br><span class="line">    intent.putExtra<span class="params">(<span class="string">"return-data"</span>, <span class="literal">false</span>)</span>;</span><br><span class="line">    intent.putExtra<span class="params">(<span class="string">"noFaceDetection"</span>, <span class="literal">true</span>)</span>;</span><br><span class="line">    intent.putExtra<span class="params">(<span class="string">"setWallpaper"</span>, <span class="literal">false</span>)</span>;</span><br><span class="line">    intent.putExtra<span class="params">(MediaStore.EXTRA_OUTPUT, destUri)</span>;</span><br><span class="line">    activity.startActivityForResult<span class="params">(intent, Constants.REQUEST_CROP)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>方法二，选择图片的同时执行裁剪操作：</p>
<figure class="highlight openscad"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line"> *   选择并裁剪图片</span><br><span class="line"> * @param activity 接受裁剪结果的Activity</span><br><span class="line"> * @param destUri 保存裁剪后图片的Uri</span><br><span class="line"> */</span></span><br><span class="line">public static void showCrop<span class="params">(Activity activity, Uri destUri)</span> &#123;</span><br><span class="line">    Intent intent = new Intent<span class="params">(Intent.ACTION_GET_CONTENT)</span>;</span><br><span class="line">    intent.setType<span class="params">(<span class="string">"image/*"</span>)</span>;</span><br><span class="line">    <span class="comment">//set crop properties</span></span><br><span class="line">    intent.putExtra<span class="params">(<span class="string">"crop"</span>, <span class="string">"true"</span>)</span>;</span><br><span class="line">    <span class="comment">//indicate aspect of desired crop</span></span><br><span class="line">    intent.putExtra<span class="params">(<span class="string">"aspectX"</span>, <span class="number">1</span>)</span>;</span><br><span class="line">    intent.putExtra<span class="params">(<span class="string">"aspectY"</span>, <span class="number">1</span>)</span>;</span><br><span class="line">    intent.putExtra<span class="params">(<span class="string">"scale"</span>, <span class="literal">true</span>)</span>;</span><br><span class="line">    <span class="comment">//indicate output X and Y</span></span><br><span class="line">    intent.putExtra<span class="params">(<span class="string">"outputX"</span>, Constants.AVATAR_DIMEN_MEDIUM)</span>;</span><br><span class="line">    intent.putExtra<span class="params">(<span class="string">"outputY"</span>, Constants.AVATAR_DIMEN_MEDIUM)</span>;</span><br><span class="line">    <span class="comment">//retrieve data on return</span></span><br><span class="line">    intent.putExtra<span class="params">(<span class="string">"return-data"</span>, <span class="literal">false</span>)</span>;</span><br><span class="line">    intent.putExtra<span class="params">(<span class="string">"noFaceDetection"</span>, <span class="literal">true</span>)</span>;</span><br><span class="line">    intent.putExtra<span class="params">(<span class="string">"setWallpaper"</span>, <span class="literal">false</span>)</span>;</span><br><span class="line">    intent.putExtra<span class="params">(MediaStore.EXTRA_OUTPUT, destUri)</span>;</span><br><span class="line">    activity.startActivityForResult<span class="params">(intent, Constants.REQUEST_GALLERY)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="加载资源的另一种方法_[20131218]">加载资源的另一种方法 [20131218]</h3><p>Android系统中有多重方法加载资源文件，比如读取drawable目录的图片可以用getResources().getDrawable()，读取values目录的字符串可以用getResources().getString()，读取raw目录的文件可以用getResources().openRawResource()，读取assets目录的文件可以用getAssets().open()，这些都是Android系统特有的方法，除此之外，我们还可以用Java提供的加载资源的方法，这种方法不受位置限制，可以放在源文件相同的目录，下面是例子：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 比如要加载src/com/douban/shuo/res/目录下的icon.png图片</span></span><br><span class="line"><span class="comment">// 可以这样做：</span></span><br><span class="line"><span class="built_in">String</span> path = <span class="string">"com/douban/shuo/res/icon.png"</span>;</span><br><span class="line">InputStream <span class="keyword">is</span> = getClassLoader().getResourceAsStream(path);</span><br><span class="line">Drawable.createFromStream(<span class="keyword">is</span>, <span class="string">"src"</span>);</span><br></pre></td></tr></table></figure>
<p>getResourceAsStream是JDK 1.1开始就有的方法，可以通过ClassLoader加载任何格式的资源，返回一个InputStream供使用，具体路径解析规则可以看看这篇文章<a href="http://blog.csdn.net/ouyang_peng/article/details/8856764" target="_blank" rel="external">ClassLoader.getResourceAsStream() 与 Class.getResourceAsStream()的区别</a></p>
<h3 id="在onActivityResult中显示Dialog_[20131218]">在onActivityResult中显示Dialog [20131218]</h3><p>有时会遇到这样的场景，通过startActivityForResult调用某一个应用等待返回结果，然后在onActivityResult中需要异步处理的同时显示对话框，如果直接在onActivityResult中调用Dialog.show()会报错，因为onActivityResult是在onResume之前，一个类似的问题是，在onSaveInstanceState调用之后也不能进行FragmentTransaction的commit操作，这两个都影响到DialogFragment，正确的做法有两种：</p>
<ul>
<li>方法一：在onPostResume显示对话框</li>
<li>方法二：在onActivityResult设置一个标志(比如mPendingShowDialog)为true，然后在onResume()的时候检查标志，如果为true就显示对话框</li>
</ul>
<p>注意：不仅是Dialog，处理Fragment相关的transactions和commit操作都需要考虑这个问题，在onSaveInstanceState调用之后如果需要commit，请替换成commitAllowingStateLoss，如果不允许状态丢失，就需要寻找其它替代方法。</p>
<p>详细解释可以参考：<a href="http://stackoverflow.com/questions/16265733/failure-delivering-result-onactivityforresult" target="_blank" rel="external">“Failure Delivering Result ” - onActivityForResult</a>。</p>
<h3 id="建议所有ID都定义在values里面_[20131218]">建议所有ID都定义在values里面 [20131218]</h3><p>MenuItem ID最好和其它的resource id一样，定义在values里面，可以避免冲突，直接使用系统的Menu.FIRST递增容易冲突，比如和ShareActionProvider冲突(测试时看到使用的ID是2，Menu.FIRST值为1)</p>
<h3 id="Fragment的背景问题_[20131017]">Fragment的背景问题 [20131017]</h3><p>如果使用Activity+Fragment的结构的话，一般至少会有三种背景，最底层的是Theme的背景，属性为<code>android:windowBackgroun d</code>，这个如果没有设置默认是白色/黑色（依主题不同），中间层是Activity的<code>android:background</code>，上面一层是Fragment的<code>android:background</code>,如果Fragment里面的View也有背景的话就会有多层背景，会有过度绘制的问题，性能会下降很多，4.1以上的系统的开发者选项里有一个<strong>[显示GPU过度绘制]</strong>选项，开启后会用颜色表示过度绘制的区域，从最优到最差依次是蓝绿淡红和红，除了个别图标和层次较深的文字以外，一般如果大片区域出现淡红色和红色就是比较严重的性能问题，特别是在ListView等多层嵌套的控件里。</p>
<p>这时候就需要针对性的进行优化，一般有两种方法：</p>
<ol>
<li>优化布局，尽量减少层次，典型的如使用RelativeLayout，使用merge，使用Canvas直接绘制（极端情况下，阅读类应用很多都是这样）等；</li>
<li>去除不必要的背景，没有特殊需要的话，Activity不设置背景，大部分情况下Fragment也可以不设置背景，网上建议将android:windowBackground设置为@null在很多时候会有问题，比如Activity被销毁再打开的时候会呈现短暂的黑色背景（其实是没有背景），如果Activity不设置背景在某些情况下也会出现这种情况，特别是在内存不足Activity被销毁后从最近任务列表返回时。</li>
</ol>
<blockquote>
<p>Fragment不设置背景存在的问题是，如果采用的是一个Activity+多个Fragment切换的结构，在部分机型上，Fragment切换后，前一个Fragment的画面会残留在背景上，造成重影现象，原因应该是系统认为Fragment没有设置背景所以没有强制刷新，真正的原因需要看源码才能确定。</p>
</blockquote>
<p>更详细的绘图性能调优方法可以参考<a href="http://www.curious-creature.org/2012/12/01/android-performance-case-study/" target="_blank" rel="external">Android Performance Case Study</a>，具体应用时，还需要考虑到小米/魅族等机型和2.3系统的兼容性问题</p>
<h3 id="魅族M9的资源解析_[20131017]">魅族M9的资源解析 [20131017]</h3><p>如果在res目录里存在不能识别的资源ID会直报InflateException导致Crash，M9使用2.3系统，不能识别3.0以上才支持的ActionBar相关的属性，比如 <code>android:actionBarStyle</code> ，所以使用ActionBarSherlock时，ActionBar相关的属性必须分开放，不带android命名空间的放在values目录，带android命名空间的必须放在values-v14目录，这个之前Bear的日记里也有提到，具体见 <a href="https://github.com/JakeWharton/ActionBarSherlock/issues/446" target="_blank" rel="external">ABS causes an InflateException on some devices</a></p>
<h3 id="摩托ME525的ListView显示_[20131017]">摩托ME525的ListView显示 [20131017]</h3><p>如果ListView设置了MATCH_PARENT但是内容太少又没有撑满空间，ListView会自动缩小至显示内容所需区域，空白空间会显示默认的背景色，在ME525上是灰色块，解决办法是在主题里加上：</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;item name=<span class="string">"android:overScrollFooter"</span>&gt;<span class="variable">@android</span><span class="symbol">:color/transparent&lt;/item&gt;</span></span><br></pre></td></tr></table></figure>
<p>或者在布局里使用</p>
<figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="label">android:</span>overScrollFooter=<span class="string">"@android:color/transparent"</span></span><br></pre></td></tr></table></figure>
<p>具体见 <a href="http://stackoverflow.com/questions/10655646/background-color-listview" target="_blank" rel="external">Background color (listview?)</a></p>
<h3 id="ImageView的adjustViewBounds属性_[20131017]">ImageView的adjustViewBounds属性 [20131017]</h3><ol>
<li><p>adjustViewBounds属性设置为true的作用是保持原始图片的长宽比，某些情况下这可能不是你想要的效果，比如广播里缩略图需要保持正方形，这时候你需要手动设置长和宽，不能使用WRAP_CONTENT，也可以重写ImageView的onMeasure()方法强制保持长宽一致，广播源码里的SquaredCheckableImage就是重写了onMeasure()方法：</p>
<figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="annotation">@Override</span></span><br><span class="line"><span class="keyword">protected</span> <span class="function"><span class="keyword">void</span> <span class="title">onMeasure</span><span class="params">(<span class="keyword">int</span> widthMeasureSpec, <span class="keyword">int</span> heightMeasureSpec)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">super</span>.onMeasure(widthMeasureSpec, heightMeasureSpec);</span><br><span class="line">	setMeasuredDimension(getMeasuredWidth(), getMeasuredWidth());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>maxHeight</code>和<code>maxWidth</code>属性必须同时设置<code>adjustViewBounds</code>为true才能生效，原因见<code>ImageView.onMeasure()</code>方法的源码，只有<code>mAdjustViewBounds</code>为true时才会检查并设置<code>resizeWidth</code>和<code>resizeHeight</code>两个布尔值，只有当这两个值至少一个为true时才会进行调整ImageView大小的缩放操作；3. 设置<code>adjustViewBounds</code>为true会导致<code>scaleType</code>重置为FIT_CENTER，源码里setAdjustViewBounds方法里有这样一句：</p>
<figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">setAdjustViewBounds</span><span class="params">(<span class="keyword">boolean</span> adjustViewBounds)</span> </span>&#123;</span><br><span class="line">	mAdjustViewBounds = adjustViewBounds;</span><br><span class="line">	<span class="keyword">if</span> (adjustViewBounds) &#123;</span><br><span class="line">		setScaleType(ScaleType.FIT_CENTER);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>具体见官方文档和ImageView的源码，还有这里 <a href="http://stackoverflow.com/questions/10917388/android-adjustviewbounds-bug" target="_blank" rel="external">android adjustViewBounds bug?</a></p>
<h3 id="ListView中Item的点击状态_[20131017]">ListView中Item的点击状态 [20131017]</h3><p>在小米1S等手机中，如果ListView的Item非常复杂，Item的子View的PRESS_STATE可能有问题，在小米1S上的表现就是ListView的onItemClick事件会触发该Item所有子View的PRESSED和FOCUSED状态，如果某些View设置了StateListDrawable为背景，就可以看到Drawable的状态变了，设置<code>android:duplicateParentState</code> <code>android:descendantFocusability</code> <code>android:focusable</code> <code>android:focusableInTouchMode</code> <code>android:clickable</code> 均没有效果，StackOverFlow上给出的解决办法（以LinearLayout为例）：</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">NoPressStateLinearLayout</span> <span class="keyword"><span class="keyword">extends</span></span> <span class="title">LinearLayout</span> &#123;</span></span><br><span class="line">	......</span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    public void setPressed(boolean pressed) &#123;</span><br><span class="line"><span class="comment">//        super.setPressed(pressed);</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果上面的办法还不行，也可以这样：</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">NoPressStateLinearLayout</span> <span class="keyword"><span class="keyword">extends</span></span> <span class="title">LinearLayout</span> &#123;</span></span><br><span class="line">	......</span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> void dispatchSetPressed(boolean pressed) &#123;</span><br><span class="line">        <span class="comment">// avoid handing on the event to the child views</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>需要注意的是，如果子View需要处理这些状态，可能会有冲突，ListView的事件响应问题还可以参考 <a href="http://cyrilmottier.com/2011/11/23/listview-tips-tricks-4-add-several-clickable-areas/" target="_blank" rel="external">ListView Tips &amp; Tricks #4: Add Several Clickable Areas</a></p>
<h3 id="Shape_Drawable填充问题_[20131017]">Shape Drawable填充问题 [20131017]</h3><p>广播里需要用到一个自定义的带边框的Button背景，开始我写的是这样的：</p>
<figure class="highlight processing"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="built_in">shape</span> xmlns:android=<span class="string">"http://schemas.android.com/apk/res/android"</span></span><br><span class="line">       android:<span class="built_in">shape</span>=<span class="string">"rectangle"</span>&gt;</span><br><span class="line">    &lt;<span class="built_in">stroke</span></span><br><span class="line">            android:<span class="variable">width</span>=<span class="string">"1dp"</span></span><br><span class="line">            android:<span class="built_in">color</span>=<span class="string">"@color/soft_white"</span>/&gt;</span><br><span class="line">    &lt;corners</span><br><span class="line">            android:radius=<span class="string">"1dp"</span>/&gt;</span><br><span class="line">&lt;/<span class="built_in">shape</span>&gt;</span><br></pre></td></tr></table></figure>
<p>只是一个边框，大部分机子上这样就可以了，但是在部分索尼（如我的Xperia U上）和摩托的机子（如ME525）上会出现只有边框，中间部分是全黑的，原因是这个Shape只有边框，中间的区域没有东西（没有任何颜色绘制），正常情况没有东西就不会绘制任何东西，但是部分机子不知道为何会填充默认的黑色背景，解决办法是中间区域设置为透明，修改后的drawable如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">shape</span> <span class="attribute">xmlns:android</span>=<span class="value">"http://schemas.android.com/apk/res/android"</span></span><br><span class="line">       <span class="attribute">android:shape</span>=<span class="value">"rectangle"</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!--内部用透明色填充--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">solid</span></span><br><span class="line">            <span class="attribute">android:color</span>=<span class="value">"@color/transparent"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">stroke</span></span><br><span class="line">            <span class="attribute">android:width</span>=<span class="value">"1dp"</span></span><br><span class="line">            <span class="attribute">android:color</span>=<span class="value">"@color/soft_white"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">corners</span></span><br><span class="line">            <span class="attribute">android:radius</span>=<span class="value">"1dp"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">shape</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="HTTP发送大量数据_[20131017]">HTTP发送大量数据 [20131017]</h3><p>2.0版广播支持发布带图和图片批量上传，测试过程发现在Nexus S 2.3系统上多次出现发送失败但是又没有抛异常的情况，后来找到原因了，是natalya库里的HttpRequest里使用的SimpleMultipartEntity处理Multipart类型数据有问题，代码：</p>
<figure class="highlight processing"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">......</span><br><span class="line">   ByteArrayOutputStream out = <span class="keyword">new</span> ByteArrayOutputStream();</span><br><span class="line">   ......</span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> addPart(<span class="keyword">final</span> <span class="keyword">String</span> <span class="variable">key</span>, <span class="keyword">final</span> <span class="keyword">String</span> fileName, <span class="keyword">final</span> InputStream fin, <span class="keyword">String</span> type, <span class="keyword">final</span> <span class="built_in">boolean</span> isLast)&#123;</span><br><span class="line">......</span><br><span class="line">           out.write(<span class="string">"Content-Transfer-Encoding: binaryrnrn"</span>.getBytes());</span><br><span class="line">		<span class="comment">// 这里会读取InputStream并全部写入到ByteArrayOutputStream中，数据量大时会造成OOM</span></span><br><span class="line">           <span class="keyword">final</span> <span class="built_in">byte</span>[] tmp = <span class="keyword">new</span> <span class="built_in">byte</span>[<span class="number">4096</span>];</span><br><span class="line">           <span class="built_in">int</span> l = <span class="number">0</span>;</span><br><span class="line">           <span class="keyword">while</span> ((l = fin.read(tmp)) != -<span class="number">1</span>) &#123;</span><br><span class="line">               out.write(tmp, <span class="number">0</span>, l);</span><br><span class="line">           &#125;</span><br><span class="line">......</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p>加注释的那一行就是问题所在，上传文件时会一次性读取全部的数据流并写入到ByteArrayOutputStream，超过一定限制时会造成OOM。<br><a href="http://developer.android.com/reference/java/net/HttpURLConnection.html" target="_blank" rel="external">HttpURLConnection</a> 文档里说明了POST数据时，HttpURLConnection默认是读取全部数据到内存然后再通过网络发送，如果数据量过大建议使用<code>setFixedLengthStreamingMode(int)</code>（知道需要POST的数据流的精确长度时）或<code>setChunkedStreamingMode(int)</code>（无法计算或不知道需要POST的数据流的精确长度时）:</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Posting Content</span><br><span class="line"></span><br><span class="line">To upload data to <span class="tag">a</span> web server, configure the connection <span class="keyword">for</span> output using <span class="function"><span class="title">setDoOutput</span><span class="params">(true)</span></span><span class="class">.For</span> best performance, you should call either `<span class="function"><span class="title">setFixedLengthStreamingMode</span><span class="params">(int)</span></span>` when the <span class="tag">body</span> length is known <span class="keyword">in</span> advance, or `<span class="function"><span class="title">setChunkedStreamingMode</span><span class="params">(int)</span></span>` when it is not. Otherwise HttpURLConnection will be forced to buffer the complete request <span class="tag">body</span> <span class="keyword">in</span> memory before it is transmitted, wasting (and possibly exhausting) heap and increasing latency.</span><br></pre></td></tr></table></figure>
<h3 id="时区与日期显示问题_[20131017]">时区与日期显示问题 [20131017]</h3><p>现在豆瓣API返回的日期字符串默认都是东八区的本地时间，实际显示时如果不考虑时区，在东八区以外的地区就会有问题，特别是用于和本地时间比较时，所以解析API返回的日期字符串时需要给DateFormat设置时区，这样解析出来的Date才是对的，方法如下：</p>
<figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// API时间的默认时区</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> TimeZone TIME_ZONE_CHINA = TimeZone.getTimeZone(<span class="string">"GMT+8"</span>);</span><br><span class="line"><span class="comment">// 豆瓣API返回的时间格式</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String DATE_FORMAT_STRING = <span class="string">"yyyy-MM-dd HH:mm:ss"</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="function">Date <span class="title">parseDate</span><span class="params">(String dateStr)</span> </span>&#123;</span><br><span class="line">    DateFormat df = <span class="keyword">new</span> SimpleDateFormat(DATE_FORMAT_STRING);</span><br><span class="line">    df.setTimeZone(TIME_ZONE_CHINA);</span><br><span class="line">    <span class="keyword">final</span> ParsePosition position = <span class="keyword">new</span> ParsePosition(<span class="number">0</span>);</span><br><span class="line">    <span class="function"><span class="keyword">return</span> df.<span class="title">parse</span><span class="params">(dateStr, position)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="用adb备份和恢复应用数据_[20131218]">用adb备份和恢复应用数据 [20131218]</h3><p>日常开发过程中有时会碰到app签名不一致需要卸载重新安装的问题，重新安装之后之前的应用配置和数据就都丢失了，有个技巧可以在卸载前备份数据，在重新安装后恢复数据：</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 假设包名是 com.douban.shuo</span></span><br><span class="line"><span class="comment">// 备份包名对应app的数据</span></span><br><span class="line">adb backup com<span class="class">.douban</span><span class="class">.shuo</span></span><br><span class="line"><span class="comment">// 从备份中恢复数据</span></span><br><span class="line">adb restore backup.ab</span><br></pre></td></tr></table></figure>
<p>注意：使用前提是手机已经解锁，其实adb backup/restore是系统提供的一个备份工具，可以用于整机备份，有兴趣的可以这篇文章：<a href="http://forum.xda-developers.com/showthread.php?t=1420351" target="_blank" rel="external">Full Phone Backup without Unlock or Root</a>，至于通过代码的方式备份和恢复应用数据，可以参考官方文档，国内的话由于网络原因估计不太好用：<a href="http://developer.android.com/guide/topics/data/backup.html" target="_blank" rel="external">Data Backup</a></p>
<h3 id="APK签名检测脚本_[20131218]">APK签名检测脚本 [20131218]</h3><p>写了一个简单的apk签名检测脚本，可以显示签名的详细信息：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="shebang">#!/bin/bash</span></span><br><span class="line"><span class="comment">#jarsigner -verify -verbose -certs $1</span></span><br><span class="line">INPUT=<span class="variable">$1</span></span><br><span class="line">OUTPUT=apk.tmp</span><br><span class="line">rm -rf <span class="variable">$&#123;OUTPUT&#125;</span> <span class="number">2</span>&gt;&amp;<span class="number">1</span> &gt; /dev/null</span><br><span class="line">unzip <span class="variable">$&#123;INPUT&#125;</span> <span class="operator">-d</span> <span class="variable">$&#123;OUTPUT&#125;</span> <span class="number">2</span>&gt;&amp;<span class="number">1</span> &gt; /dev/null</span><br><span class="line">openssl pkcs7 -inform DER -noout -print_certs -text -in <span class="variable">$&#123;OUTPUT&#125;</span>/META-INF/CERT.RSA</span><br><span class="line">rm -rf <span class="variable">$&#123;OUTPUT&#125;</span> <span class="number">2</span>&gt;&amp;<span class="number">1</span> &gt; /dev/null</span><br></pre></td></tr></table></figure>
<h3 id="切换Android_Studio的默认构建类型_[20131218]">切换Android Studio的默认构建类型 [20131218]</h3><p>Android Studio—View—Tool Windows—Build Variants可以切换，一般默认建议使用release签名+开启debug的构建类型，以广播饿为例，build.gradle有如下配置：</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="title">buildTypes</span> &#123;</span><br><span class="line">    <span class="title">release</span> &#123;</span><br><span class="line">        <span class="title">signingConfig</span> signingConfigs.release</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    beta &#123;</span><br><span class="line">        <span class="title">signingConfig</span> signingConfigs.release</span><br><span class="line">        debuggable <span class="built_in">true</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">debug</span> &#123;</span><br><span class="line">        <span class="title">packageNameSuffix</span> null</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Android Studio中设置默认使用beta构建类型，build生成的apk默认使用release签名，但是BuildConfig.DEBUG为true，debug为true便于调试，使用release签名避免了给其他人测试时，或者使用qaci的构建包时签名冲突，当然，也有其它的解决办法，比如所有人使用统一的debug签名，我觉得使用buildTypes比较灵活，还可以自定义很多其它选项，比如修改包名，修改应用名，版本名，添加构建时间等。</p>
<h3 id="Idea插件QAPlug_[20131017]">Idea插件QAPlug [20131017]</h3><p>  IDEA有很多有用的插件，我推荐一个<a href="http://qaplug.com/" target="_blank" rel="external">QAPlug</a>，这个插件包含几个独立的模块(<a href="http://plugins.jetbrains.com/search/index?pr=idea&amp;search=qaplug" target="_blank" rel="external">Findbugs/PMD/CheckStyle</a>)，可选择安装，Findbugs是一个代码缺陷检测工具，可以帮助寻找代码中的各种隐患或潜在的性能问题；PMD是一个静态代码分析工具，可以检查复杂的逻辑结构/资源使用/重复代码等问题，帮助提高代码质量；CheckStyle则专注于代码规范，可以检查命名约定/类设计/方法设计/import/空白等。这三个工具都可以指定自定义的规则，推荐每次版本发布前对代码进行一次全面的检查，有些提示是不需要修改的，但是还是能发现一些潜在的问题的，对于Android,还要做的一个检查是Lint，版本发布前对代码做一个全面的检查至少可以避免一些平时因疏忽导致的低级问题。这个插件和IDEA集成，使用起来非常简单，官网页面有详细的说明。</p>
<h3 id="跳转到第三方应用无法返回的问题_[20131218]">跳转到第三方应用无法返回的问题 [20131218]</h3><p>广播的时间线有很多地方可以点击跳转到第三方应用，比如电影/FM/小组/浏览器等 ，测试发现奇怪的问题，跳转到第三方应用后，按返回键没有返回到广播，直接返回到手机桌面了，后来发现是FLAG_ACTIVITY_NEW_TASK的问题，使用Intent跳转到其它应用，如果没有添加Intent.FLAG_ACTIVITY_NEW_TASK标志，按返回键时不能返回到上一个应用，在4.1以上系统上都是如此。所以，建议在使用Intent跳转到第三方应用的地方添加Intent.FLAG_ACTIVITY_NEW_TASK标志（选择图片等功能不需要，这时候他们位于同一个TASK）。</p>
<p>系统的某些功能和应用也存在这个问题，在某个应用处于前台时，如果点击通知栏的一个通知跳转到了其它应用，返回时有可能直接返回了手机桌面，而不是当前应用。</p>
<h3 id="无法直接启动其它应用的Activity_[20131218]">无法直接启动其它应用的Activity [20131218]</h3><p>广播的上传通知点击后会弹出一个对话框形式的Activity，有几次点击没反应，log里看到如下的错误信息：</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">12-03 15:52:33.133 611-622/? W/ActivityManager﹕ Permission Denial: starting Intent &#123; flg=0x10000000 cmp=com.douban.shuo/.app.UploadNotifyActivity bnds=[<span class="link_label">0,102</span>][<span class="link_reference">768,230</span>] (has extras) &#125; from null (pid=-1, uid=10191) not exported from uid 10192</span><br><span class="line">12-03 15:52:33.133 611-622/? W/ActivityManager﹕ Unable to send startActivity intent</span><br><span class="line">java.lang.SecurityException: Permission Denial: starting Intent &#123; flg=0x10000000 cmp=com.douban.shuo/.app.UploadNotifyActivity bnds=[<span class="link_label">0,102</span>][<span class="link_reference">768,230</span>] (has extras) &#125; from null (pid=-1, uid=10191) not exported from uid 10192</span><br></pre></td></tr></table></figure>
<p>而且只有4.4的系统存在这个问题，查资料后发现从4.4版本开始，使用ClassName方式直接调用第三方Activity是不允许的，需要目标Activity在AndroidManifest里面明确声明了android:exported=”true” 才可以，需要注意的是，不仅仅是第三方应用，只要是不同的进程，都必须声明为android:exported=”true”，Activity才可以被直接调用。</p>
<h3 id="Kitkat系统WebView的换行问题_[20131218]">Kitkat系统WebView的换行问题 [20131218]</h3><p>4.4开始，webview不会自动断行，需要在html里处理，代码里也可以这样处理：</p>
<figure class="highlight openscad"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> <span class="params">(MiscUtils.hasKitkat<span class="params">()</span>)</span> &#123;</span><br><span class="line">    settings.setLayoutAlgorithm<span class="params">(WebSettings.LayoutAlgorithm.TEXT_AUTOSIZING)</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>但是很多网页这样不解决问题，还需要在Html里处理：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">pre</span> <span class="attribute">style</span>=<span class="value">"word-wrap: break-word; white-space: pre-wrap;"</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>@wuzeyi 说吃喝组里是直接在html里写上了word-break:break-all;有用到可以参考。</p>
<p>详细的方法可以看官方的说明：</p>
<p><a href="http://developer.android.com/guide/webapps/migrating.html#Columns" target="_blank" rel="external">http://developer.android.com/guide/webapps/migrating.html#Columns</a>和<a href="https://code.google.com/p/android/issues/detail?id=62378" target="_blank" rel="external">https://code.google.com/p/android/issues/detail?id=62378</a></p>
<p>补充一点，4.2以后的系统，通过JS调用Java函数时，需要添加@JavascriptInterface这个Annotation，否则系统会忽略这个函数。</p>
<h3 id="Framelayout的margin设置无效的问题_[20131218]">Framelayout的margin设置无效的问题 [20131218]</h3><p>4.0以前的系统FrameLayout的margin设置有时不生效，查资料发现原因是没有设置layout_gravity，这是4.0之前系统个一个BUG，见<a href="https://code.google.com/p/android/issues/detail?id=28057" target="_blank" rel="external">https://code.google.com/p/android/issues/detail?id=28057</a>，猜测是因为FrameLayout需要一个定位的锚点，布局文件里加入以下代码即可：</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 设置上下margin必须有top，设置左右margin必须有left</span></span><br><span class="line"><span class="comment">// layout_gravity必须有一个值，margin才会生效</span></span><br><span class="line"><span class="string">android:</span>layout_gravity=<span class="string">"top|left"</span></span><br></pre></td></tr></table></figure>
<p>代码里可以这样设置：</p>
<figure class="highlight openscad"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">MarginLayoutParams marginParams = new MarginLayoutParams<span class="params">(this.getLayoutParams<span class="params">()</span>)</span>;  </span><br><span class="line">marginParams.height = this.getMeasuredHeight<span class="params">()</span>;  </span><br><span class="line">marginParams.width = this.getMeasuredWidth<span class="params">()</span>;  </span><br><span class="line">marginParams.setMargins<span class="params">(l,t,r,b)</span>;  </span><br><span class="line">LayoutParams layoutParams = new LayoutParams<span class="params">(marginParams)</span>;  </span><br><span class="line"><span class="comment">// 起作用的是这一行</span></span><br><span class="line">layoutParams.gravity = Gravity.TOP|Gravity.LEFT;  </span><br><span class="line">setLayoutParams<span class="params">(layoutParams)</span>;</span><br></pre></td></tr></table></figure>
<p>参考文档：</p>
<p><a href="http://blog.csdn.net/fengye810130/article/details/9147695" target="_blank" rel="external">http://blog.csdn.net/fengye810130/article/details/9147695</a><br><a href="http://stackoverflow.com/questions/5401952/framelayout-margin-not-working" target="_blank" rel="external">http://stackoverflow.com/questions/5401952/framelayout-margin-not-working</a></p>

        
      
    </div>

    <div class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </div>
  </div>


    
      

  <div class="post post-type-normal ">
    <div class="post-header">

      
      
        <h1 class="post-title">
          
          
            
              <a class="post-title-link" href="/2011/05/30/ubuntu-install-software-and-config/">
                Ubuntu软件安装和使用配置
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          发表于 2011-05-30
        </span>

        
          <span class="post-category">
            &nbsp; | &nbsp; 分类于
            
              <a href="/categories/Linux/">Linux</a>

              
              

            
          </span>
        

        
          
            <span class="post-comments-count">
            &nbsp; | &nbsp;
            <a href="/2011/05/30/ubuntu-install-software-and-config/#comments" >
              <span class="post-comments-count ds-thread-count" data-thread-key="2011/05/30/ubuntu-install-software-and-config/"></span>
            </a>
          </span>
          
        
      </div>
    </div>

    <div class="post-body">

      
      

      
        
          <ul>
<li>2011.05.06 Ver 1.0</li>
<li>2011.05.11 Ver 1.1</li>
<li>2011.05.12 Ver 1.2</li>
<li>2011.05.29 Ver 1.3 增加Dropbox安装配置，删除过时内容  </li>
</ul>
<p>每次重装的话都要安装很多软件，修改配置，我的记性不是很好，每次都要网上查，这次记下来这些资料备用</p>
<h2 id="系统安装">系统安装</h2><h3 id="全新安装">全新安装</h3><p>WIN+LINUX双系统的话，在WIN下面可以用easybcd启动ISO安装，当然，最简单的方式是直接刻盘光盘安装。要补充的一点是，如果安装时要使用lvm，就必须使用文本模式安装，图形模式虽然也可以，但比较复杂，而且容易出问题<br>单系统模式就简单了，直接使用整个硬盘，但是要自己控制分区方案的话，分区时要选择高级，手动分区</p>
<h3 id="保留数据重装">保留数据重装</h3><p>保留数据一般是指保留/home分区的数据，前提是你的/home是单独分区的。重装系统时选高级手动分区，只格式化/分区，/home分区直接挂载为新的/home分区(我不清楚lvm虚拟卷可不可直接识别和挂载)，不能格式化，为避免新系统的配置文件冲突，最好使用livecd先删除/home/username目录下的.开头的大量配置文件，如果nautilus里看不到，使用Ctrl+H就可以看到所有的隐藏文件，新系统的用户名最好和原来的一致，这样就可以减少转移文件的麻烦。更详细的说明可以参考这篇文章：<a href="http://ubuntuabc.com/123/?p=23" target="_blank" rel="external">http://ubuntuabc.com/123/?p=23</a></p>
<h2 id="新系统配置">新系统配置</h2><h3 id="配置软件源">配置软件源</h3><p>首先备份原有的软件源 </p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo cp /etc/apt/sources<span class="class">.list</span> /etc/apt/sources<span class="class">.list</span><span class="class">.bak</span></span><br></pre></td></tr></table></figure>
<p>然后去 </p>
<figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="label">http:</span>//wiki.ubuntu<span class="preprocessor">.org</span>.cn/Qref/Source</span><br></pre></td></tr></table></figure>
<p>挑选一个速度最快的源加入 sources.list 不要加入多个，反而影响索引速度  </p>
<h4 id="更新软件源">更新软件源</h4><figure class="highlight q"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-<span class="built_in">get</span> <span class="keyword">update</span></span><br></pre></td></tr></table></figure>
<h4 id="更新系统">更新系统</h4><figure class="highlight processing"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-<span class="built_in">get</span> <span class="built_in">dist</span>-upgrade</span><br></pre></td></tr></table></figure>
<h4 id="Unity配置工具">Unity配置工具</h4><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-<span class="keyword">get</span> install compizconfig-settings-manager</span><br></pre></td></tr></table></figure>
<h4 id="PPA管理器">PPA管理器</h4><p>安装y-ppa manager</p>
<figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo<span class="instruction"> add-apt-repository </span>ppa:webupd8team/y-ppa-manager</span><br><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get install y-ppa-manager</span><br></pre></td></tr></table></figure>
<h4 id="字体安装">字体安装</h4><p>直接双击字体，在查看对话框中点击安装即可<br>或者直接复制到~/.fonts目录就可以，不需要任何配置，非常简单<br>文件浏览右键管理员</p>
<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-<span class="keyword">get</span> install nautilus-gksu</span><br></pre></td></tr></table></figure>
<h4 id="设置中文MAN">设置中文MAN</h4><figure class="highlight inform7"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alias cman='<span class="keyword">man</span> -M /usr/share/<span class="keyword">man</span>/zh_CN'</span><br></pre></td></tr></table></figure>
<p>想用中文man时： cman command<br>想用英文man： man command</p>
<p>设置curl不检查SSL证书</p>
<figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo <span class="string">'insecure'</span> &amp;<span class="keyword">gt</span>;&amp;<span class="keyword">gt</span>; ~/.curlrc</span><br></pre></td></tr></table></figure>
<h4 id="Unity配置">Unity配置</h4><p>解除Unity的系统托盘显示限制</p>
<ul>
<li>命令行方式：<br>解禁所有程序</li>
</ul>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gsettings set com<span class="class">.canonical</span><span class="class">.Unity</span><span class="class">.Panel</span> systray-whitelist <span class="string">"['all']"</span></span><br></pre></td></tr></table></figure>
<p>或者只解禁部分程序，把 YOUR_APPLICATION 替换成你需要解禁的程序</p>
<figure class="highlight scilab"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gsettings set <span class="transposed_variable">com.</span><span class="transposed_variable">canonical.</span><span class="transposed_variable">Unity.</span>Panel systray-whitelist <span class="string">"['</span><span class="transposed_variable">JavaEmbeddedFrame'</span>, <span class="string">'Mumble'</span>, <span class="string">'Wine'</span>, <span class="string">'Skype'</span>, <span class="string">'hp-systray'</span>, <span class="string">'YOUR_APPLICATION'</span>]<span class="string">"</span></span><br></pre></td></tr></table></figure>
<ul>
<li>GUI 方式：<br>安装 dconf-tools</li>
</ul>
<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-<span class="keyword">get</span> install dconf-tools</span><br></pre></td></tr></table></figure>
<p>在终端中输入 dconf-editor ，然后找到  desktop &gt; unity &gt; panel ，把 systray-whitelist 的值改为 [‘all’]</p>
<h2 id="安装常用软件">安装常用软件</h2><h4 id="压缩和解压缩">压缩和解压缩</h4><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-<span class="keyword">get</span> install unace unrar zip unzip p7zip-full p7zip-rar sharutils uudeview mpack lha arj cabextract <span class="type">file</span>-roller</span><br></pre></td></tr></table></figure>
<p>不要安装源里的rar，会乱码，p7zip-rar和unrar都不会乱码  </p>
<p>新版iBus输入法，自带的版本很老，可以用ppa安装最新版</p>
<figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo<span class="instruction"> add-apt-repository </span>ppa:shawn-p-huang/ppa</span><br><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get install ibus-gtk ibus-pinyin ibus-pinyin-db-open-phrase</span><br></pre></td></tr></table></figure>
<h4 id="文本编辑器">文本编辑器</h4><p>自带的gedit其实够用，可以不安装其他的，需要的话也可以安装scribes，geany<br>需要修改一点gedit的配置才可以自动识别中文编码：运行gconf-editor，展开/apps/gedit-2/preferences/encodings节点，加入GB18030和BIG5-HKSCS</p>
<h4 id="浏览器">浏览器</h4><p>11.04自带最新的4.0</p>
<figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo<span class="instruction"> add-apt-repository </span>ppa:mozillateam/firefox-stable</span><br><span class="line">sudo apt-get update &amp;amp;&amp;amp; sudo apt-get upgrade</span><br></pre></td></tr></table></figure>
<p>如果没有安装Firefox可以直接</p>
<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-<span class="keyword">get</span> install firefox</span><br></pre></td></tr></table></figure>
<p>安装Chrome稳定版，需要直接去官网下载</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wget http<span class="variable">s:</span>//<span class="keyword">dl</span>-ssl.google.<span class="keyword">com</span>/linux/direct/google-chrome-stable_current_i386.<span class="keyword">deb</span></span><br><span class="line">sudo dpkg -<span class="keyword">i</span> google-chrome-stable_current_i386.<span class="keyword">deb</span></span><br></pre></td></tr></table></figure>
<p>Chrome 10以后的版本默认为难看的楷体，字体修改方法</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">http:</span><span class="comment">//imcn.me/html/y2011/3306.html</span></span><br><span class="line"><span class="string">http:</span><span class="comment">//imcn.me/html/y2011/3386.html</span></span><br><span class="line"><span class="string">http:</span><span class="comment">//www.linuxidc.com/Linux/2011-05/35375.htm</span></span><br></pre></td></tr></table></figure>
<h4 id="文档阅读">文档阅读</h4><p>增强自带的PDF阅读能力，增加pdf和其它格式的相互转换</p>
<figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="label">sudo</span> apt-<span class="preprocessor">get</span> install <span class="keyword">poppler-data </span><span class="keyword">poppler-utils</span></span><br></pre></td></tr></table></figure>
<h4 id="备份同步">备份同步</h4><p>安装dropbox<br>首先官网下载</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http<span class="variable">s:</span>//www.dropbox.<span class="keyword">com</span>/download?<span class="keyword">dl</span>=packages/nautilus-dropbox_0.<span class="number">6.7</span>_i386.<span class="keyword">deb</span></span><br></pre></td></tr></table></figure>
<p>安装后还需要安装dropbox的daemon，这个无法直接下载，可以用vpn<br>或者直接用代理下载下面这个</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">http:</span><span class="comment">//www.getdropbox.com/download?plat=lnx.x86</span></span><br></pre></td></tr></table></figure>
<p>然后直接在～目录解压，文件会解压到 ~/.dropbox-dist/ ，daemon就装好了，直接就可以运行<br>更详细的说明见：<br><a href="http://freedomhui.com/?p=149" target="_blank" rel="external">http://freedomhui.com/?p=149</a><br>电子书制作和阅读</p>
<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-<span class="keyword">get</span> install calibre fbreader</span><br></pre></td></tr></table></figure>
<p>需要最新版的话可以自己下载源码编译安装</p>
<h4 id="图像处理">图像处理</h4><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-<span class="keyword">get</span> install gimp inkscape imagemagick dia</span><br></pre></td></tr></table></figure>
<h4 id="音乐播放">音乐播放</h4><figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo<span class="instruction"> add-apt-repository </span>ppa:nilarimogard/webupd8</span><br><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get install audacious</span><br></pre></td></tr></table></figure>
<p>MP3 GBK标签转码工具</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-<span class="built_in">get</span> install <span class="keyword">python</span>-mutagen</span><br></pre></td></tr></table></figure>
<p>执行转码</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find . -iname <span class="string">"*.mp3"</span> -execdir mid3iconv <span class="operator">-e</span> gbk &#123;&#125; ;</span><br></pre></td></tr></table></figure>
<h4 id="视频播放">视频播放</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get <span class="operator"><span class="keyword">install</span> vlc vlc-<span class="keyword">plugin</span>-pulse mozilla-<span class="keyword">plugin</span>-vlc</span><br><span class="line">sudo apt-<span class="keyword">get</span> <span class="keyword">install</span> mplayer smplayer</span></span><br></pre></td></tr></table></figure>
<h4 id="下载工具">下载工具</h4><p>最常见的wget和aria2c</p>
<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-<span class="keyword">get</span> install wget aria2</span><br></pre></td></tr></table></figure>
<p>推荐用下面的Firefox插件</p>
<figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo<span class="instruction"> add-apt-repository </span>ppa:plushuang-tw/uget-devel</span><br><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get install uget</span><br></pre></td></tr></table></figure>
<p>特别推荐使用优蛋 linux版，很好用<br>下载地址</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">http:</span><span class="comment">//bbs.ylmf.net/forum.php?mod=viewthread&amp;amp;tid=1916551</span></span><br></pre></td></tr></table></figure>
<p>当然，用Firefox的话，有最强大的下载插件：DownThemAll，最好的下载工具</p>
<h4 id="安装Ubuntu_Tweak">安装Ubuntu Tweak</h4><figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo<span class="instruction"> add-apt-repository </span>ppa:tualatrix/ppa</span><br><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get install ubuntu-tweak</span><br></pre></td></tr></table></figure>
<h2 id="桌面美化">桌面美化</h2><h4 id="安装Faenza图标和equinox主题">安装Faenza图标和equinox主题</h4><figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo<span class="instruction"> add-apt-repository </span>ppa:tiheum/equinox</span><br><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get install faenza-icon-theme  gtk2-engines-equinox equinox-theme</span><br></pre></td></tr></table></figure>
<h4 id="安装elementary主题">安装elementary主题</h4><figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo<span class="instruction"> add-apt-repository </span>ppa:elementaryart/elementarydesktop</span><br><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get install elementary-theme elementary-icon-theme elementary-wallpapers</span><br></pre></td></tr></table></figure>
<h4 id="安装nautilus-elementary">安装nautilus-elementary</h4><figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo<span class="instruction"> add-apt-repository </span>ppa:am-monkeyd/nautilus-elementary-ppa</span><br><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get dist-upgrade</span><br></pre></td></tr></table></figure>
<p>打开/usr/share/themes/.gtkrc，注释掉这一行： <code>#include &quot;apps/nautilus-elementary.rc&quot;</code><br>重启 nautilus -q</p>
<h4 id="安装系统状态指示器">安装系统状态指示器</h4><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wget http:<span class="comment">//mh21.de/temp/indicator-multiload_0.1-0~5_i386.deb</span></span><br><span class="line">sudo dpkg -<span class="tag">i</span> indicator-multiload_0.<span class="number">1</span>-<span class="number">0</span>~<span class="number">5</span>_i386.deb</span><br></pre></td></tr></table></figure>
<h2 id="开发环境配置">开发环境配置</h2><h4 id="安装基本开发环境和版本工具">安装基本开发环境和版本工具</h4><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="label">sudo</span> apt-<span class="preprocessor">get</span> install <span class="keyword">build-essential </span>autoconf automake1.<span class="number">9</span> cvs <span class="keyword">subversion </span>git mercurial</span><br></pre></td></tr></table></figure>
<h4 id="安装JDK">安装JDK</h4><p>需要在更新管理器里启用第三方软件源</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-<span class="built_in">get</span> install <span class="keyword">sun</span>-java6-jdk <span class="keyword">sun</span>-java6-plugin</span><br></pre></td></tr></table></figure>
<p>或者通过ppa安装</p>
<figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo<span class="instruction"> add-apt-repository </span>ppa:ferramroberto/java</span><br><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get install sun-java6-jdk sun-java6-plugin</span><br></pre></td></tr></table></figure>
<h4 id="配置JDK">配置JDK</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="operator"><span class="keyword">update</span>-alternatives <span class="comment">--config java</span></span></span><br></pre></td></tr></table></figure>
<p>解决Java程序乱码<br>注释掉此文件的所有行：</p>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/usr/lib/jvm/java-<span class="number">6</span>-sun/jre/lib/fonts/fonts.dir</span><br><span class="line">http:<span class="regexp">//wiki</span>.ubuntu.org.cn/Java<span class="variable">%E5</span><span class="variable">%AE</span><span class="variable">%89</span><span class="variable">%E8</span><span class="variable">%A3</span><span class="variable">%85</span><span class="variable">%E9</span><span class="variable">%85</span><span class="variable">%8D</span><span class="variable">%E7</span><span class="variable">%BD</span><span class="variable">%AE</span></span><br></pre></td></tr></table></figure>
<h4 id="安装Android开发环境">安装Android开发环境</h4><figure class="highlight q"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-<span class="built_in">get</span> install git-core gnupg flex bison gperf build-essential zip curl zlib1g-<span class="built_in">dev</span> libc6-<span class="built_in">dev</span> x11proto-core-<span class="built_in">dev</span> libx11-<span class="built_in">dev</span></span><br></pre></td></tr></table></figure>
<h4 id="安装Eclipse">安装Eclipse</h4><p>不建议直接使用源安装，不好控制<br>建议直接去官网下载压缩包，解压即可使用，如果放在/usr/local 或 /opt 分区的话，为使用方便，需要chown root:root -R  一下，不过强烈建议直接解压放在/home分区的某个目录，使用最方便，不用担心莫名其妙的权限问题<br>添加桌面启动器和面板启动器可以参考这里：<br><a href="http://www.5dlinux.com/article/1/2008/linux_15330.html" target="_blank" rel="external">http://www.5dlinux.com/article/1/2008/linux_15330.html</a><br>我的方法是直接 ln -s一个放在~/bin目录里</p>
<h4 id="安装Ruby">安装Ruby</h4><p>系统自带的是1.8.7，需要使用1.9.2的话必须自己编译安装，不过无论使用哪个版本，强烈推荐使用rvm安装和配置ruby环境，与系统隔离，使用和卸载都方便，官网的安装教程非常详细，推荐安装在～/目录</p>
<figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash  &lt; <span class="list">(<span class="keyword">curl</span> -s https<span class="keyword">://rvm</span>.beginrescueend.com/install/rvm)</span></span><br></pre></td></tr></table></figure>
<p>在.bashrc的最后加入</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">[[ -s "$HOME/.rvm/scripts/rvm" ]]</span> &amp;amp;&amp;amp; . <span class="string">"$HOME/.rvm/scripts/rvm"</span></span><br><span class="line">rvm  install <span class="number">1.9</span>.2-p180</span><br><span class="line">rvm <span class="number">1.9</span>.2-p180</span><br><span class="line">rvm <span class="comment">--default use 1.9.2</span></span><br></pre></td></tr></table></figure>
<p>检查安装情况 <code>which ruby</code></p>
<h4 id="安装Eclipse插件">安装Eclipse插件</h4><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="constant">ADT：</span></span><br><span class="line"><span class="symbol">http:</span>/<span class="regexp">/dl-ssl.google.com/android</span><span class="regexp">/eclipse/</span></span><br><span class="line"><span class="symbol">https:</span>/<span class="regexp">/dl-ssl.google.com/android</span><span class="regexp">/eclipse/</span></span><br></pre></td></tr></table></figure>
<h2 id="其它配置">其它配置</h2><h4 id="配置Evolution使用GMail">配置Evolution使用GMail</h4><p>imap配置里用户名必须是包含@gmail.com的，要不然无法链接，而且很bt的是根本没有提示和错误说明 #ubuntu 还有imap服务器必须加端口号993 加密方式为SSL</p>
<h4 id="软件包备份还原">软件包备份还原</h4><p>备份</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo tar cizvf apt-backup.tar.gz <span class="regexp">/var/</span>cache<span class="regexp">/apt/</span>archives --<span class="keyword">exclude</span>=<span class="regexp">/var/</span>cache<span class="regexp">/apt/</span>archives<span class="regexp">/partial/</span>* --<span class="keyword">exclude</span>=<span class="regexp">/var/</span>cache<span class="regexp">/apt/</span>archives<span class="regexp">/lock</span></span><br></pre></td></tr></table></figure>
<p>还原</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get <span class="operator"><span class="keyword">update</span> &amp;amp;</span>&amp;amp; sudo tar xzvf <span class="operator"><span class="keyword">backup</span>.tar.gz -C /</span></span><br></pre></td></tr></table></figure>
<h2 id="其它软件">其它软件</h2><h4 id="图形方式编辑启动菜单">图形方式编辑启动菜单</h4><p>安装Grub Customizer</p>
<figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo<span class="instruction"> add-apt-repository </span>ppa:danielrichter2007/grub-customizer</span><br><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get install grub-customizer</span><br></pre></td></tr></table></figure>
<h4 id="安装和配置openvpn">安装和配置openvpn</h4><p>安装openvpn</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install openvpn</span><br><span class="line"></span><br><span class="line">复制配置文件到 <span class="regexp">/etc/</span>openvpn/ ，添加权限</span><br><span class="line">cd <span class="regexp">/etc/</span>openvpn/</span><br><span class="line">sudo chmod +x *</span><br><span class="line">连接openvpn</span><br><span class="line">sudo openvpn --config <span class="regexp">/etc/</span>openvpn/client.ovp --script-security <span class="number">2</span></span><br></pre></td></tr></table></figure>
<p>出现下列字样表示连接成功</p>
<figure class="highlight brainfuck"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">openvpn</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">config</span> <span class="comment">/etc/openvpn/client</span><span class="string">.</span><span class="comment">ovp</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">script</span><span class="literal">-</span><span class="comment">security</span> <span class="comment">2</span></span><br></pre></td></tr></table></figure>
<p>使用SSH Tunneling Proxy</p>
<p><a href="http://wiki.wowubuntu.com/blog/ubuntu_ssh_tunneling" target="_blank" rel="external">http://wiki.wowubuntu.com/blog/ubuntu_ssh_tunneling</a><br><a href="http://wiki.wowubuntu.com/blog/gstm" target="_blank" rel="external">http://wiki.wowubuntu.com/blog/gstm</a></p>
<h2 id="故障和问题">故障和问题</h2><p>暂无</p>

        
      
    </div>

    <div class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </div>
  </div>


    
      

  <div class="post post-type-normal ">
    <div class="post-header">

      
      
        <h1 class="post-title">
          
          
            
              <a class="post-title-link" href="/2011/05/15/android-xml-shape-get-started/">
                Android XML Shape使用入门
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          发表于 2011-05-15
        </span>

        
          <span class="post-category">
            &nbsp; | &nbsp; 分类于
            
              <a href="/categories/Android/">Android</a>

              
              

            
          </span>
        

        
          
            <span class="post-comments-count">
            &nbsp; | &nbsp;
            <a href="/2011/05/15/android-xml-shape-get-started/#comments" >
              <span class="post-comments-count ds-thread-count" data-thread-key="2011/05/15/android-xml-shape-get-started/"></span>
            </a>
          </span>
          
        
      </div>
    </div>

    <div class="post-body">

      
      

      
        
          <p>XML<br>Drawable是google为android定义的一种声明式图形文件格式，类似于SVG，但更简单，官方文档非常少，网上有人整理了一份文档，值得细看：</p>
<p><a href="http://idunnolol.com/android/drawables.html" target="_blank" rel="external">Android Drawable XML<br>Documentation</a></p>
<p>下面是一个简单的使用例子：</p>
<p>Activity代码  </p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.app.<span class="type">Activity</span>;  </span><br><span class="line"><span class="keyword">import</span> android.os.<span class="type">Bundle</span>;</span><br><span class="line"></span><br><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">DrawableTest</span> <span class="keyword"><span class="keyword">extends</span></span> <span class="title">Activity</span> &#123;</span>  </span><br><span class="line"><span class="annotation">@Override</span>  </span><br><span class="line">public void onCreate(<span class="type">Bundle</span> savedInstanceState) &#123;  </span><br><span class="line"><span class="keyword">super</span>.onCreate(savedInstanceState);  </span><br><span class="line">setContentView(<span class="type">R</span>.layout.main);  </span><br><span class="line">&#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>布局文件  </p>
<figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml <span class="variable">version=</span><span class="string">"1.0"</span> <span class="variable">encoding=</span><span class="string">"utf-8"</span>?&gt;  </span><br><span class="line">&lt;LinearLayout</span><br><span class="line">xmlns:<span class="variable">android=</span><span class="string">"http://schemas.android.com/apk/res/android"</span>  </span><br><span class="line">android:<span class="variable">orientation=</span><span class="string">"vertical"</span> android:<span class="variable">layout_width=</span><span class="string">"fill_parent"</span>  </span><br><span class="line">android:<span class="variable">layout_height=</span><span class="string">"fill_parent"</span>&gt;  </span><br><span class="line">&lt;TextView android:<span class="variable">textSize=</span><span class="string">"16sp"</span></span><br><span class="line">android:<span class="variable">layout_width=</span><span class="string">"fill_parent"</span>  </span><br><span class="line">android:<span class="variable">layout_height=</span><span class="string">"wrap_content"</span> android:<span class="variable">text=</span><span class="string">"@string/hello"</span>  </span><br><span class="line">android:<span class="variable">background=</span><span class="string">"@drawable/rect_gradient_linear"</span> /&gt;  </span><br><span class="line">&lt;TextView android:<span class="variable">textSize=</span><span class="string">"16sp"</span></span><br><span class="line">android:<span class="variable">layout_width=</span><span class="string">"fill_parent"</span>  </span><br><span class="line">android:<span class="variable">layout_height=</span><span class="string">"wrap_content"</span> android:<span class="variable">text=</span><span class="string">"@string/hello"</span>  </span><br><span class="line">android:<span class="variable">background=</span><span class="string">"@drawable/oval_gradient_linear"</span> /&gt;  </span><br><span class="line">&lt;TextView android:<span class="variable">textSize=</span><span class="string">"16sp"</span></span><br><span class="line">android:<span class="variable">layout_width=</span><span class="string">"fill_parent"</span>  </span><br><span class="line">android:<span class="variable">layout_height=</span><span class="string">"wrap_content"</span> android:<span class="variable">text=</span><span class="string">"@string/hello"</span>  </span><br><span class="line">android:<span class="variable">background=</span><span class="string">"@drawable/rect_solid_stroke"</span> /&gt;  </span><br><span class="line">&lt;TextView android:<span class="variable">textSize=</span><span class="string">"16sp"</span></span><br><span class="line">android:<span class="variable">layout_width=</span><span class="string">"fill_parent"</span>  </span><br><span class="line">android:<span class="variable">layout_height=</span><span class="string">"wrap_content"</span> android:<span class="variable">text=</span><span class="string">"@string/hello"</span>  </span><br><span class="line">android:<span class="variable">background=</span><span class="string">"@drawable/rect_solid_corners"</span> /&gt;  </span><br><span class="line">&lt;/LinearLayout&gt;</span><br></pre></td></tr></table></figure>
<p>Shapre使用实例，共四个：  </p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="pi">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="title">shape</span> <span class="attribute">xmlns:android</span>=<span class="value">"http://schemas.android.com/apk/res/android"</span>  </span><br><span class="line"><span class="attribute">android:shape</span>=<span class="value">"rectangle"</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="title">gradient</span> <span class="attribute">android:startColor</span>=<span class="value">"#ffff0000"</span></span><br><span class="line"><span class="attribute">android:endColor</span>=<span class="value">"#FF4488ee"</span>  </span><br><span class="line"><span class="attribute">android:type</span>=<span class="value">"linear"</span> <span class="attribute">android:angle</span>=<span class="value">"270"</span> /&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="title">padding</span> <span class="attribute">android:left</span>=<span class="value">"2dp"</span> <span class="attribute">android:top</span>=<span class="value">"2dp"</span> <span class="attribute">android:right</span>=<span class="value">"2dp"</span>  </span><br><span class="line"><span class="attribute">android:bottom</span>=<span class="value">"2dp"</span> /&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="title">shape</span>&gt;</span>  </span><br><span class="line">[/xml]  </span><br><span class="line">[xml]  </span><br><span class="line"><span class="pi">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="title">shape</span> <span class="attribute">xmlns:android</span>=<span class="value">"http://schemas.android.com/apk/res/android"</span>  </span><br><span class="line"><span class="attribute">android:shape</span>=<span class="value">"oval"</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="title">gradient</span> <span class="attribute">android:startColor</span>=<span class="value">"#FFaa6622"</span></span><br><span class="line"><span class="attribute">android:endColor</span>=<span class="value">"#FF2288ee"</span>  </span><br><span class="line"><span class="attribute">android:type</span>=<span class="value">"linear"</span> /&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="title">padding</span> <span class="attribute">android:left</span>=<span class="value">"2dp"</span> <span class="attribute">android:top</span>=<span class="value">"2dp"</span> <span class="attribute">android:right</span>=<span class="value">"2dp"</span>  </span><br><span class="line"><span class="attribute">android:bottom</span>=<span class="value">"2dp"</span> /&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="title">shape</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="pi">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="title">shape</span> <span class="attribute">xmlns:android</span>=<span class="value">"http://schemas.android.com/apk/res/android"</span>  </span><br><span class="line"><span class="attribute">android:shape</span>=<span class="value">"rectangle"</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="title">solid</span> <span class="attribute">android:color</span>=<span class="value">"#ffff0000"</span> /&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="title">padding</span> <span class="attribute">android:left</span>=<span class="value">"5dp"</span> <span class="attribute">android:top</span>=<span class="value">"2dp"</span> <span class="attribute">android:right</span>=<span class="value">"2dp"</span>  </span><br><span class="line"><span class="attribute">android:bottom</span>=<span class="value">"5dp"</span> /&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="title">stroke</span> <span class="attribute">android:width</span>=<span class="value">"2dp"</span> <span class="attribute">android:color</span>=<span class="value">"#ffffffff"</span></span><br><span class="line"><span class="attribute">android:dashGap</span>=<span class="value">"5dp"</span>  </span><br><span class="line"><span class="attribute">android:dashWidth</span>=<span class="value">"10dp"</span> /&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="title">shape</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="pi">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="title">shape</span> <span class="attribute">xmlns:android</span>=<span class="value">"http://schemas.android.com/apk/res/android"</span>  </span><br><span class="line"><span class="attribute">android:shape</span>=<span class="value">"rectangle"</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="title">solid</span> <span class="attribute">android:color</span>=<span class="value">"#8800ff00"</span> /&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="title">padding</span> <span class="attribute">android:left</span>=<span class="value">"5dp"</span> <span class="attribute">android:top</span>=<span class="value">"5dp"</span> <span class="attribute">android:right</span>=<span class="value">"5dp"</span>  </span><br><span class="line"><span class="attribute">android:bottom</span>=<span class="value">"5dp"</span> /&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="title">corners</span> <span class="attribute">android:radius</span>=<span class="value">"15dp"</span> /&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="title">shape</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>下面是系统源码里的例子，文件为：source/frameworks/base/core/res/res/drawable/progress_horizontal.xml  </p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">layer-list</span></span><br><span class="line"><span class="attribute">xmlns:android</span>=<span class="value">"http://schemas.android.com/apk/res/android"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="title">item</span> <span class="attribute">android:id</span>=<span class="value">"@android:id/background"</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="title">shape</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="title">corners</span> <span class="attribute">android:radius</span>=<span class="value">"5dip"</span> /&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="title">gradient</span>  </span><br><span class="line"><span class="attribute">android:startColor</span>=<span class="value">"#ff9d9e9d"</span>  </span><br><span class="line"><span class="attribute">android:centerColor</span>=<span class="value">"#ff5a5d5a"</span>  </span><br><span class="line"><span class="attribute">android:centerY</span>=<span class="value">"0.75"</span>  </span><br><span class="line"><span class="attribute">android:endColor</span>=<span class="value">"#ff747674"</span>  </span><br><span class="line"><span class="attribute">android:angle</span>=<span class="value">"270"</span>  </span><br><span class="line">/&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="title">shape</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="title">item</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="title">item</span> <span class="attribute">android:id</span>=<span class="value">"@android:id/secondaryProgress"</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="title">clip</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="title">shape</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="title">corners</span> <span class="attribute">android:radius</span>=<span class="value">"5dip"</span> /&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="title">gradient</span>  </span><br><span class="line"><span class="attribute">android:startColor</span>=<span class="value">"#80ffd300"</span>  </span><br><span class="line"><span class="attribute">android:centerColor</span>=<span class="value">"#80ffb600"</span>  </span><br><span class="line"><span class="attribute">android:centerY</span>=<span class="value">"0.75"</span>  </span><br><span class="line"><span class="attribute">android:endColor</span>=<span class="value">"#a0ffcb00"</span>  </span><br><span class="line"><span class="attribute">android:angle</span>=<span class="value">"270"</span>  </span><br><span class="line">/&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="title">shape</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="title">clip</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="title">item</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="title">item</span> <span class="attribute">android:id</span>=<span class="value">"@android:id/progress"</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="title">clip</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="title">shape</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="title">corners</span> <span class="attribute">android:radius</span>=<span class="value">"5dip"</span> /&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="title">gradient</span>  </span><br><span class="line"><span class="attribute">android:startColor</span>=<span class="value">"#ffffd300"</span>  </span><br><span class="line"><span class="attribute">android:centerColor</span>=<span class="value">"#ffffb600"</span>  </span><br><span class="line"><span class="attribute">android:centerY</span>=<span class="value">"0.75"</span>  </span><br><span class="line"><span class="attribute">android:endColor</span>=<span class="value">"#ffffcb00"</span>  </span><br><span class="line"><span class="attribute">android:angle</span>=<span class="value">"270"</span>  </span><br><span class="line">/&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="title">shape</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="title">clip</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="title">item</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="title">layer-list</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>可供参考的资料：<br>Layout secrets: “layer-list” and “include”<br><a href="http://android.amberfog.com/?p=9" target="_blank" rel="external">http://android.amberfog.com/?p=9</a></p>

        
      
    </div>

    <div class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </div>
  </div>


    
      

  <div class="post post-type-normal ">
    <div class="post-header">

      
      
        <h1 class="post-title">
          
          
            
              <a class="post-title-link" href="/2011/02/26/android-dev-notes-01/">
                Android开发杂记（一）
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          发表于 2011-02-26
        </span>

        
          <span class="post-category">
            &nbsp; | &nbsp; 分类于
            
              <a href="/categories/Android/">Android</a>

              
              

            
          </span>
        

        
          
            <span class="post-comments-count">
            &nbsp; | &nbsp;
            <a href="/2011/02/26/android-dev-notes-01/#comments" >
              <span class="post-comments-count ds-thread-count" data-thread-key="2011/02/26/android-dev-notes-01/"></span>
            </a>
          </span>
          
        
      </div>
    </div>

    <div class="post-body">

      
      

      
        
          <p>这些是这半年做Android开发的小部分技巧记录，摘录自我的Tweets，大部分没有发在Twitter上的以后想起来了再记一下</p>
<ul>
<li><p>android:layout_alignLeft 指该控件距离边父控件的边距，android:paddingLeft 指该控件内部内容，如文本距离该控件的边距.当按钮分别设置以上两个属性时，效果不一样的 android:paddingLeft=”30px”，按钮上设置的内容（例如图片）离按钮左边边界30个像素 android:layout_marginLeft=”30px”，整个按钮离左边设置的内容30个像素</p>
</li>
<li><p>Activity中添加 <code>android:windowSoftInputMode=”adjustPan”</code> 就可以自适应键盘的显示与隐藏</p>
</li>
</ul>
<ol>
<li>android:listSelector的值可以是一个Drawable，也可以是一个颜色值</li>
</ol>
<ul>
<li><p>ListView的默认背景色是#FF191919，如果不做修改，而且设置了背景图片的话，那么拖动时就会出现黑色背景，解决办法是设置 <code>android:cacheColorHint</code><br>为#00000000</p>
</li>
<li><p>Android截屏代码： <code>view.setDrawingCacheEnabled(true);Bitmap bp =
view.getDrawingCache();</code></p>
</li>
<li><p>当ListView中要显示的数据集合发生变化时，如集合中增删数据，这时需要刷新UI以响应数据变化，可调用adapter的notifyDataSetChanged();方法来刷新界面</p>
</li>
<li><p>FrameLayout是最简单的一个布局对象。在它里面的的所有显示对象都将固定在屏幕的左上角，不能指定位置，但允许有多个显示对象，只是后一个会直接覆盖在前一个之上显示，会把前面的组件部分或全部挡住</p>
</li>
<li><p>View类默认提供的是一个100*100大小的空白空间，自定义View必须重写OnDraw()和onMeasure()方法，否则父控件无法得知你自定义的View的尺寸</p>
</li>
<li><p>解决SeekBar下边显示不全的办法：将是layout_height为warp_content，再设置适当的minHeight和maxHeight值</p>
</li>
<li><p>View设置背景透明的方法：<code>View v = findViewById(R.id.content);</code> //找到你要设透明背景的layout 的id 然后 <code>v.getBackground().setAlpha(100);</code> //0~255透明度值</p>
</li>
<li><p>由于触摸模式和普通模式切换的存在，在程序中不能依赖焦点和选中状态，因为某一时刻不一定存在焦点和/或选中状态</p>
</li>
<li><p>设置WebView的缩放需要设置一下 <code>browser.getSettings().setUseWideViewPort(true);</code></p>
</li>
<li><p>去掉标题栏titleBar的方法：<code>requestWindowFeature(Window.FEATURE_NO_TITLE);</code></p>
</li>
<li><p>全屏背景透明的设置方法：  <code>Activity：android:theme=&quot;@android:style/Theme.Translucent.NoTitleBar.Fullscreen&quot;</code></p>
</li>
<li><p>建议所有Android开发者升级ADT到最近的9.0，这个版本修复了以前Eclipse的logcat日志输出中不支持中文的BUG(Issue<br>1590)，现在采用UTF8编码，支持所有Unicode字符了</p>
</li>
</ul>

        
      
    </div>

    <div class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </div>
  </div>


    
      

  <div class="post post-type-normal ">
    <div class="post-header">

      
      
        <h1 class="post-title">
          
          
            
              <a class="post-title-link" href="/2011/02/01/android-intentservice-getting-started/">
                Android IntentService使用简介
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          发表于 2011-02-01
        </span>

        
          <span class="post-category">
            &nbsp; | &nbsp; 分类于
            
              <a href="/categories/Android/">Android</a>

              
              

            
          </span>
        

        
          
            <span class="post-comments-count">
            &nbsp; | &nbsp;
            <a href="/2011/02/01/android-intentservice-getting-started/#comments" >
              <span class="post-comments-count ds-thread-count" data-thread-key="2011/02/01/android-intentservice-getting-started/"></span>
            </a>
          </span>
          
        
      </div>
    </div>

    <div class="post-body">

      
      

      
        
          <p>春节放假有点自己的时间，准备抽空做个饭否上传照片的工具，其中上传功能需要用到后台任务，Android上的后台任务主要有三种实现方式，一是按照常规的Java方式，自己写线程，二是使用SDK封装好的后台任务类AsyncTask，三是使用Service，线程和AsyncTask都是和Activity的生命周期绑定的，而Service有自己的独立生命周期，考虑到以后的扩展和代码的清晰，决定使用Service，看到国外的博客和Google<br>Groups里面都推荐使用IntentService，网上搜了一下，几乎没有中文的资料，于是决定记录一下学习使用IntentService的笔记。</p>
<p>IntentService的位置是android.app.IntentService，官方文档的介绍我翻译一下：</p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">IntentService <span class="keyword">is</span> a base <span class="type">class</span> <span class="keyword">for</span> Services <span class="keyword">that</span> handle asynchronous requests (expressed <span class="keyword">as</span> Intents) <span class="function_start"><span class="keyword">on</span></span> demand. Clients send requests <span class="keyword">through</span> startService(Intent) calls; <span class="keyword">the</span> service <span class="keyword">is</span> started <span class="keyword">as</span> needed, handles each Intent <span class="keyword">in</span> turn using a worker thread, <span class="keyword">and</span> stops itself when <span class="keyword">it</span> runs <span class="keyword">out of</span> work.</span><br></pre></td></tr></table></figure>
<p>IntentService是一个用于按需处理异步请求的Service基类，调用方通过<br>startService(Intent)启动服务，IntentService为每一个Intent开启一个单独的工作线程，并且在任务完成时自动终止服务。</p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">This <span class="string">"work queue processor"</span> pattern <span class="keyword">is</span> commonly used <span class="keyword">to</span> offload tasks <span class="keyword">from</span> an <span class="type">application</span>'s main thread. The IntentService <span class="type">class</span> exists <span class="keyword">to</span> simplify this pattern <span class="keyword">and</span> take care <span class="keyword">of</span> <span class="keyword">the</span> mechanics. To use <span class="keyword">it</span>, extend IntentService <span class="keyword">and</span> implement onHandleIntent(Intent). IntentService will receive <span class="keyword">the</span> Intents, <span class="command">launch</span> a worker thread, <span class="keyword">and</span> stop <span class="keyword">the</span> service <span class="keyword">as</span> appropriate.</span><br></pre></td></tr></table></figure>
<p>这种“工作队列处理器”模式通常用于某个程序主线程之外的后台任务。IntentService类简化了这种机制。要使用这种工作队列模式，只使用继承IntentService并实现onHandleIntent(Intent)方法。IntentService会接受Intents，启动工作线程，并在合适的时候终止服务。</p>
<figure class="highlight vbnet"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">All requests are handled <span class="keyword">on</span> a <span class="built_in">single</span> worker thread -- they may <span class="keyword">take</span> <span class="keyword">as</span> <span class="built_in">long</span> <span class="keyword">as</span> necessary (<span class="keyword">and</span> will <span class="keyword">not</span> block the application<span class="comment">'s main loop), but only one request will be processed at a time.</span></span><br></pre></td></tr></table></figure>
<p>文档的最后说，所有的请求都由一个单独的线程处理，它们可以占用任意长的时间（不会造成主线程阻塞），但是同一时间智慧处理一个请求。我的理解是先进先出的队列模式。</p>
<p>下面首先看看我的示例代码，这个是写的饭否照片上传的代码，</p>
<pre><code>:::java
<span class="keyword">package</span> com.mcxiaoke.fanfou.photo;

<span class="keyword">import</span> java.io.File;  
<span class="keyword">import</span> android.app.IntentService;  
<span class="keyword">import</span> android.content.Intent;  
<span class="keyword">import</span> android.os.IBinder;  
<span class="keyword">import</span> android.util.Log;

<span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">PhotoUploadService</span> <span class="keyword">extends</span> <span class="title">IntentService</span> </span>{  
<span class="annotation">@Override</span>  
<span class="keyword">public</span> <span class="function">IBinder <span class="title">onBind</span><span class="params">(Intent intent)</span> </span>{  
Log.d(tag, <span class="string">"onBind()"</span>);  
<span class="function"><span class="keyword">return</span> <span class="keyword">super</span>.<span class="title">onBind</span><span class="params">(intent)</span></span>;  
}

<span class="annotation">@Override</span>  
<span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">onCreate</span><span class="params">()</span> </span>{  
Log.d(tag, <span class="string">"onCreate()"</span>);  
<span class="keyword">super</span>.onCreate();  
}

<span class="annotation">@Override</span>  
<span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">onDestroy</span><span class="params">()</span> </span>{  
Log.d(tag, <span class="string">"onDestroy()"</span>);  
<span class="keyword">super</span>.onDestroy();  
}

<span class="annotation">@Override</span>  
<span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">onStart</span><span class="params">(Intent intent, <span class="keyword">int</span> startId)</span> </span>{  
Log.d(tag, <span class="string">"onStart()"</span>);  
<span class="keyword">super</span>.onStart(intent, startId);  
}

<span class="annotation">@Override</span>  
<span class="keyword">public</span> <span class="function"><span class="keyword">int</span> <span class="title">onStartCommand</span><span class="params">(Intent intent, <span class="keyword">int</span> flags, <span class="keyword">int</span> startId)</span> </span>{  
Log.d(tag, <span class="string">"onStartCommand()"</span>);  
<span class="function"><span class="keyword">return</span> <span class="keyword">super</span>.<span class="title">onStartCommand</span><span class="params">(intent, flags, startId)</span></span>;  
}

<span class="annotation">@Override</span>  
<span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">setIntentRedelivery</span><span class="params">(<span class="keyword">boolean</span> enabled)</span> </span>{  
Log.d(tag, <span class="string">"setIntentRedelivery()"</span>);  
<span class="keyword">super</span>.setIntentRedelivery(enabled);  
}

<span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> String tag=<span class="string">"PhotoUploadService"</span>;

<span class="comment">// public PhotoUploadService(String name) {  </span>
<span class="comment">// super(name);  </span>
<span class="comment">// Log.d(tag, "PhotoUploadService()");  </span>
<span class="comment">// }</span>

<span class="function"><span class="keyword">public</span> <span class="title">PhotoUploadService</span><span class="params">()</span> </span>{  
<span class="keyword">super</span>(<span class="string">"PhotoUploadService"</span>);  
Log.d(tag, <span class="string">"PhotoUploadService()"</span>);  
}

<span class="annotation">@Override</span>  
<span class="keyword">protected</span> <span class="function"><span class="keyword">void</span> <span class="title">onHandleIntent</span><span class="params">(Intent intent)</span> </span>{  
Log.d(tag, <span class="string">"onHandleIntent()"</span>);  
File photo=<span class="keyword">new</span> File(intent.getStringExtra(<span class="string">"photo"</span>));  
FanfouApi api=<span class="keyword">new</span> FanfouApi(<span class="string">"username"</span>, <span class="string">"password"</span>);  
api.uploadPhoto(photo, <span class="string">"upload photo use service test."</span>);

}  
}  
</code></pre><p>你要进行的后台任务写在onHandleIntent方法里就可以了，上面那个Override的方式都是我用于打印调试信息的，都可以不用重写。这里说一下IntentService的生命周期，根据Logcat打印的消息，那几个OnXXX的执行顺序从前到后依次是：</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">PhotoUploadService</span><span class="params">()</span></span> -- 构造函数  </span><br><span class="line"><span class="function"><span class="title">onCreate</span><span class="params">()</span></span> -- 只在Service第一次启动时调用  </span><br><span class="line"><span class="function"><span class="title">onStartCommand</span><span class="params">()</span></span> -- 每次调用startService时都会调用这个方法  </span><br><span class="line"><span class="function"><span class="title">onStart</span><span class="params">()</span></span> -- SDK将这个方法标记为过时的，用<span class="function"><span class="title">onStartCommand</span><span class="params">()</span></span>替代  </span><br><span class="line"><span class="function"><span class="title">onHandleIntent</span><span class="params">()</span></span> -- 要做的任务都写在这个方法里  </span><br><span class="line"><span class="function"><span class="title">onDestroy</span><span class="params">()</span></span> -- 服务终止时调用</span><br></pre></td></tr></table></figure>
<p>关于继承IntentService，构造函数需要注意一个地方，Eclipse默认生成的构造函数是  </p>
<figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">PhotoUploadService</span><span class="params">(String name)</span> </span>&#123;  </span><br><span class="line"><span class="keyword">super</span>(name);  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>使用这个默认构造函数的话会报一个运行时错误： <code>java.lang.InstantiationException</code>，在Google Groups里找到了解决办法，继承IntentService的类必须有一个public的无参的构造函数，将上面Eclipse自动生成的构造函数改为下面这样的就可以了：<br><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">PhotoUploadService</span><span class="params">()</span> </span>&#123;  </span><br><span class="line"><span class="keyword">super</span>(<span class="string">"someone"</span>);  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>为什么要这样改，看IntentService构造函数的源码：  </p>
<figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">IntentService</span><span class="params">(String name)</span> </span>&#123;  </span><br><span class="line"><span class="keyword">super</span>();  </span><br><span class="line">mName = name;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>SDK文档里说构造函数里面的服务名字只在调试时有用，可以随便写一个名字。</p>
<p>另一个需要特别指出的时，在onHandleIntent里不需要自己处理线程，或者新启线程，IntentService默认会为队列中的任务启动后台线程，源码中的实现是这样的：  </p>
<pre><code>:::java
<span class="keyword">private</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">ServiceHandler</span> <span class="keyword"><span class="keyword">extends</span></span> <span class="title">Handler</span> {</span>  
public <span class="type">ServiceHandler</span>(<span class="type">Looper</span> looper) {  
<span class="keyword">super</span>(looper);  
}

<span class="annotation">@Override</span>  
public void handleMessage(<span class="type">Message</span> msg) {  
onHandleIntent((<span class="type">Intent</span>)msg.obj);  
stopSelf(msg.arg1);  
}  
}

<span class="annotation">@Override</span>  
public void onCreate() {  
<span class="keyword">super</span>.onCreate();  
<span class="type">HandlerThread</span> thread = <span class="keyword">new</span> <span class="type">HandlerThread</span>(<span class="string">"IntentService["</span> + mName +
<span class="string">"]"</span>);  
thread.start();

mServiceLooper = thread.getLooper();  
mServiceHandler = <span class="keyword">new</span> <span class="type">ServiceHandler</span>(mServiceLooper);  
}  
</code></pre><p>看源码可以得知onHanldeIntent()是在新的后台线程HandlerThread里执行的，所以不需要要我们自己新开线程。</p>
<p>参考资料：  </p>
<p><a href="http://androidappdocs.appspot.com/reference/android/app/IntentService.html" target="_blank" rel="external">IntentService</a>  </p>
<p><a href="http://androidappdocs.appspot.com/reference/android/app/Service.html" target="_blank" rel="external">Service</a><br><a href="http://stackoverflow.com/questions/3197335/android-restful-api-service" target="_blank" rel="external">Android: restful API<br>service</a><br><a href="https://groups.google.com/forum/#!topic/android-developers/YTXqvKP526w" target="_blank" rel="external">IntentService instantiation<br>exception</a><br><a href="http://stackoverflow.com/questions/3817272/android-design-considerations-asynchtask-vs-service-intentservice" target="_blank" rel="external">android design considerations: AsynchTask vs<br>Service</a></p>

        
      
    </div>

    <div class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </div>
  </div>


    
      

  <div class="post post-type-normal ">
    <div class="post-header">

      
      
        <h1 class="post-title">
          
          
            
              <a class="post-title-link" href="/2010/12/12/compile-and-use-libcurl-in-mingw-win32-how-to/">
                使用MinGW编译libcurl静态库
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          发表于 2010-12-12
        </span>

        
          <span class="post-category">
            &nbsp; | &nbsp; 分类于
            
              <a href="/categories/Develop/">Develop</a>

              
              

            
          </span>
        

        
          
            <span class="post-comments-count">
            &nbsp; | &nbsp;
            <a href="/2010/12/12/compile-and-use-libcurl-in-mingw-win32-how-to/#comments" >
              <span class="post-comments-count ds-thread-count" data-thread-key="2010/12/12/compile-and-use-libcurl-in-mingw-win32-how-to/"></span>
            </a>
          </span>
          
        
      </div>
    </div>

    <div class="post-body">

      
      

      
        
          <p>libcurl<br>7.21以后的版本在Windows下的编译比较简单，自带了MinGW和VC环境的Makefile文件，首先去Curl官网下载源代码：<br><a href="http://curl.haxx.se/download.html" target="_blank" rel="external">http://curl.haxx.se/download.html</a>，</p>
<p>任选一个下载即可，推荐这个：<br><a href="http://curl.haxx.se/download/curl-7.21.2.tar.gz" target="_blank" rel="external">curl-7.21.2.tar.gz</a><br>下载完成后解压开，打开命令行进入curl源码目录，(在此之前请先设置好MinGW的环境变量)：  </p>
<pre><code><span class="tag">cd</span> <span class="tag">curl-7</span><span class="class">.21</span><span class="class">.2</span> 
</code></pre><p>编译libcurl库文件：  </p>
<pre><code><span class="built_in">cd</span> lib  
make <span class="operator">-f</span> Makefile.m32  
</code></pre><p>等待编译完成即可<br>编译curl可执行文件： </p>
<pre><code><span class="built_in">cd</span> ../src  
make <span class="operator">-f</span> Makefile.m32  
</code></pre><p>一会儿就编译完成了</p>
<p>编译完成后，我们需要复制include头文件和库文件到一个目录供程序开发用 </p>
<ol>
<li>新建curllib目录  </li>
<li>新建curllib/include目录，将源代码include目录里的curl文件夹复制到curllib/include目录，这些是使用libcurl需要的头文件  </li>
<li>新建curllib/lib目录，将源代码lib目录里编译好的库文件libcurl.a，libcurldll.a，libcurl.dll复制到curllib目录  </li>
<li>将MinGW安装目录下lib文件夹里的libwldap32.a和libws2_32.a复制到curllib/lib目录</li>
</ol>
<p>至此，curllib就是我们开发中要使用到的libcurl的全部文件，下面新建一个测试程序，假设文件名为curltest.c，代码如下：</p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="command">\#</span>include <span class="command">\&lt;</span>stdio.h<span class="command">\&gt;</span>  </span><br><span class="line"><span class="command">\#</span>include <span class="command">\&lt;</span>curl/curl.h<span class="command">\&gt;</span></span><br><span class="line"></span><br><span class="line">int main(void)  </span><br><span class="line"><span class="special">&#123;</span>  </span><br><span class="line">CURL <span class="command">\*</span>curl;  </span><br><span class="line">CURLcode res;</span><br><span class="line"></span><br><span class="line">curl = curl<span class="command">\_</span>easy<span class="command">\_</span>init();  </span><br><span class="line">if(curl) <span class="special">&#123;</span>  </span><br><span class="line">curl<span class="command">\_</span>easy<span class="command">\_</span>setopt(curl, CURLOPT<span class="command">\_</span>URL, "www.google.com");  </span><br><span class="line">res = curl<span class="command">\_</span>easy<span class="command">\_</span>perform(curl);</span><br><span class="line"></span><br><span class="line">/<span class="command">\*</span> always cleanup <span class="command">\*</span>/  </span><br><span class="line">curl<span class="command">\_</span>easy<span class="command">\_</span>cleanup(curl);  </span><br><span class="line"><span class="special">&#125;</span>  </span><br><span class="line">return 0;  </span><br><span class="line"><span class="special">&#125;</span></span><br></pre></td></tr></table></figure>
<p>** 方法一、命令行编译使用licurl的程序</p>
<p>假设测试代码curltest.c位于e:/project<br>假设curllib文件夹的位置为c:/curllib<br>命令行运行下列命令编译这个测试程序：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cd <span class="symbol">e:</span>/project  </span><br><span class="line">gcc -<span class="constant">I</span>. -<span class="constant">Ic</span><span class="symbol">:/curllib/include</span> -g -<span class="constant">O2</span> -<span class="constant">DCURL</span>\_STATICLIB -c curltest.c  </span><br><span class="line">gcc -s -o curltest.exe curltest.o -<span class="constant">Lc</span><span class="symbol">:/curllib/lib</span> -lcurl -lwldap32</span><br><span class="line">-lws2\_32</span><br></pre></td></tr></table></figure>
<p>这时可以看到curltest.c目录下生成了一个curltest.exe文件<br>接着在命令行输入：  </p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">curltest</span><span class="class">.exe</span></span><br></pre></td></tr></table></figure>
<p>如果看到命令行窗口输出一些HTML代码，就表示编译成功</p>
<p>** 方法二、Code::Blocks中使用libcurl静态库</p>
<ol>
<li>新建工程，在工程里添加代码同上的curltest.c文件  </li>
<li>将上面curllib/include目录下的curl文件夹复制到MinGW安装目录的include目录  </li>
<li>工程名上右键打开Build Options选项，在Compiler<br>Settings选项卡下的#defines里面输入CURL_STATICLIB，（这表示使用静态库）  </li>
<li>在Linker Settings选项卡下面的link<br>libraries里添加上面curllib/lib目录里的四个文件：</li>
</ol>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">C:curllibliblibcurl<span class="class">.a</span>  </span><br><span class="line">C:curllibliblibcurldll<span class="class">.a</span>  </span><br><span class="line">C:curllibliblibwldap32<span class="class">.a</span>  </span><br><span class="line">C:curllibliblibws2\_32.a</span><br></pre></td></tr></table></figure>
<p>然后回到工程页面，点击Build即可</p>
<p>今天为了编译和使用libcurl库折腾了一下午，记下来供需要的人参考，需要注意的是，本文中编译的是不带ssl和zlib支持的libcurl，如果需要编译支持ssl和zlib的curl，还需要先编译openssl，zlib和libssh，编译zlib比较简单，直接使用源码自带的makefile文件即可，编译openssl需要安装MSYS和Perl，还需要修改一些代码，libssh的编译依赖openssl，网上都可以找到方法，也可以看源码的README文件。</p>
<p>附一篇在C语言中使用libcurl库的文章供参考：<br><a href="http://www.ibm.com/developerworks/cn/opensource/os-curl/" target="_blank" rel="external">使用 cURL 和 libcurl 通过 Internet<br>进行对话</a><br>下面几篇是Curl的文档和教程：<br><a href="http://curl.haxx.se/docs/httpscripting.html" target="_blank" rel="external">Scripting HTTP Requests Using<br>Curl</a><br><a href="http://curl.haxx.se/docs/manpage.html" target="_blank" rel="external">Curl Man Page</a><br><a href="http://curl.haxx.se/docs/manual.html" target="_blank" rel="external">Curl Mannul</a><br><a href="http://curl.haxx.se/libcurl/c/" target="_blank" rel="external">Using The libcurl C Interface</a><br><a href="http://curl.haxx.se/libcurl/c/example.html" target="_blank" rel="external">libcurl - small example<br>snippets</a><br><a href="http://curl.haxx.se/libcurl/c/libcurl-tutorial.html" target="_blank" rel="external">programming with<br>libcurl</a></p>

        
      
    </div>

    <div class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </div>
  </div>


    
      

  <div class="post post-type-normal ">
    <div class="post-header">

      
      
        <h1 class="post-title">
          
          
            
              <a class="post-title-link" href="/2010/11/22/android-apk-files-decompile-how-to/">
                Android程序反编译流程
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          发表于 2010-11-22
        </span>

        
          <span class="post-category">
            &nbsp; | &nbsp; 分类于
            
              <a href="/categories/Android/">Android</a>

              
              

            
          </span>
        

        
          
            <span class="post-comments-count">
            &nbsp; | &nbsp;
            <a href="/2010/11/22/android-apk-files-decompile-how-to/#comments" >
              <span class="post-comments-count ds-thread-count" data-thread-key="2010/11/22/android-apk-files-decompile-how-to/"></span>
            </a>
          </span>
          
        
      </div>
    </div>

    <div class="post-body">

      
      

      
        
          <p>APK是Android<br>Package的简称，是Android平台安装包的标准封装格式，实际上是标准的zip压缩文件，里面包含清单文件，数字签名文件，压缩后的资源文件，以及二进制dex字节码文件，Android程序的反编译包括两部分，三个流程，二部分是资源文件resources.arsc的反编译和字节码文件classes.dex的反编译；三流程是资源文件反编译为人类可读的XML文本格式和图片文件，字节码文件dex反编译为标准的Java压缩格式jar(标准的Java<br>Class文件)，然后将class文件反编译为Java源代码。下面说明各个流程的方法和所需要的工具：</p>
<p><strong>1. 资源文件的反编译</strong></p>
<p>资源文件包括resources.arsc和res目录中的XML文件，如果直接打开是乱码，resources.arsc是压缩过的二进制文件，XML也是压缩过的二进制格式的文件，我们要做的是还原他们的本来面目：二进制格式的图片，和文本格式的XML文件。我们使用最方便的工具：Android<br>Apktool，这个工具的作者是XDA的高手，他同时还是Brut版Google<br>Maps的作者。这个工具使用非常方便。</p>
<p>Android<br>Apktool发布地址：<a href="http://forum.xda-developers.com/showthread.php?t=640592" target="_blank" rel="external">http://forum.xda-developers.com/showthread.php?t=640592</a><br>Android Apktool项目地址：<a href="http://code.google.com/p/android-apktool/" target="_blank" rel="external">http://code.google.com/p/android-apktool/</a></p>
<p>以Windows系统为例，需要下载这两个文件：  </p>
<p>写好的bat批处理脚本：<a href="https://android-apktool.googlecode.com/files/apktool-install-windows-r05-ibot.tar.bz2" target="_blank" rel="external">apktool-install-windows-r05-ibot.tar.bz2</a>  </p>
<p>apktool可执行文件：<a href="https://android-apktool.googlecode.com/files/apktool1.5.2.tar.bz2" target="_blank" rel="external">apktool1.5.2.tar.bz2</a></p>
<p>将它们解压到同一个文件夹就可以了，使用方法如下，<br>以Android系统自带的Gallery.apk文件为例：</p>
<ul>
<li>反编译资源文件，并将字节码反编译为smali文件：命令行输入 apktool.bat<br>d Gallery.apk<br>，当前目录下会生成一个Gallery目录，里面就是反编译好的文件，res目录里为反编译好的资源文件，smali目录里为反编译好的smali字节码文件。由于我们只需要资源文件，所以可以使用下面的命令。</li>
<li>仅反编译资源文件，命令行输入 apktool.bat d -s Gallery.apk<br>同样会生成Gallery目录，里面的res目录里为反编译好的资源文件，但是classes.dex没有反编译为smali文件。</li>
</ul>
<p><strong>2. 二进制字节码文件的反编译</strong></p>
<p>解压apk文件可以发现里面的classes.dex，这就是二进制字节码文件，我们要把它反编译为标准的Java<br>Class文件，需要的工具是dex2jar，该工具是国人开发的，目前还在不断更新中。<br>dex2jar项目地址： <a href="http://code.google.com/p/dex2jar/" target="_blank" rel="external">http://code.google.com/p/dex2jar/</a><br>dex2jar下载地址：<br><a href="https://dex2jar.googlecode.com/files/dex2jar-0.0.9.15.zip" target="_blank" rel="external">dex2jar-0.0.9.15.zip</a></p>
<p>使用方法非常简单，还是以上面的Gallery程序为例，取出里面的classes.dex文件后，命令行输入<br>dex2jar.bat classes.dex<br>就会在同级目录下发现反编译好的jar文件classes.dex.dex2jar.jar，下面的步骤就是将Jar文件反编译为Java源文件了，需要是的工具是JD-GUI，或者DJ<br>Java Decompiler。<br>JD-GUI是著名的Java反编译工具JAD的GUI版本，下载地址：<br>    <a href="http://java.decompiler.free.fr/?q=jdgui" target="_blank" rel="external">http://java.decompiler.free.fr/?q=jdgui</a><br>此程序还提供一个Eclipse插件，使用方法，直接用JD-GUI打开刚才反编译好的Jar文件就可以看到Java源代码了，如果原始程序没有经过混淆，那么你会发现代码非常清晰，很容易看懂。</p>
<p><strong>3. 使用Logcat查看代码的功能</strong></p>
<p>反编译出来后一般还有很多代码对应的功能不容易弄懂，此时可以打开程序，对照Logcat里面的调试信息，很容易看到代码对应的功能，至于代码里的资源文件ID，由于都是数字，需要到R.java里面去查找对应的资源文件名称。这是一种很好的学习的方法，但也可能被用作非法用途。</p>

        
      
    </div>

    <div class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </div>
  </div>


    
  </div>

  
  <div class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/">&raquo;</a>
  </div>


        </div>

        
      </div>


      
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <div id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      <div class="site-overview">
        <div class="site-author motion-element">
          <img class="site-author-image" src="/images/avatar.jpg" alt="mcxiaoke" />
          <p class="site-author-name">mcxiaoke</p>
        </div>
        <p class="site-description motion-element">零碎的笔记</p>
        <div class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">17</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          <div class="site-state-item site-state-categories">
            
              <span class="site-state-item-count">8</span>
              <span class="site-state-item-name">分类</span>
              
          </div>

          <div class="site-state-item site-state-tags">
            <a href="/tags">
              <span class="site-state-item-count">25</span>
              <span class="site-state-item-name">标签</span>
              </a>
          </div>

        </div>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
              <a href="https://github.com/mcxiaoke" target="_blank">GitHub</a>
            </span>
            
              <span class="links-of-author-item">
              <a href="http://www.douban.com/people/doiv" target="_blank">DouBan</a>
            </span>
            
              <span class="links-of-author-item">
              <a href="http://mcxiaoke.com/" target="_blank">Home</a>
            </span>
            
          
        </div>

        
        
          <div class="cc-license motion-element">
            <a href="http://creativecommons.org/licenses/by-nc-sa/4.0" class="cc-opacity" target="_blank">
              <img src="/images/cc-by-nc-sa.svg" alt="Creative Commons" />
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
            <p class="site-author-name">Links</p>
            
              <span class="links-of-author-item">
              <a href="http://moment.douban.com/app/" target="_blank">豆瓣一刻</a>
              </span>
            
          
        </div>
        
      </div>

      

    </div>
  </div>


    </div>

    <div id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">
  
  &copy; &nbsp;  2007 - 
  2015
  <span class="with-love">
    <i class="icon-heart"></i>
  </span>
  <span class="author">mcxiaoke</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="http://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>



      </div>
    </div>

    <div class="back-to-top"></div>
  </div>

  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js"></script>
  <script type="text/javascript" src="/js/fancy-box.js?v=0.4.3"></script>


  <script type="text/javascript" src="/js/helpers.js?v=0.4.3"></script>
  

  <script type="text/javascript" src="/vendors/velocity/velocity.min.js"></script>
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js"></script>

  <script type="text/javascript" src="/js/motion_global.js?v=0.4.3" id="motion.global"></script>



  <script type="text/javascript" src="/js/search-toggle.js"></script>

  

  <script type="text/javascript">
    $(document).ready(function () {
      if (CONFIG.sidebar === 'always') {
        displaySidebar();
      }
    });
  </script>

  

  
  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"mcxiaoke"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  


  
  
  <script type="text/javascript" src="/js/analytics_google-analytics.js?v=0.4.3"></script>


</body>
</html>
